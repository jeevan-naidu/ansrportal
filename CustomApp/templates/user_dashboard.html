
{% extends 'master.html' %}
{% block siteTitle %}Manage {{ app_name }}{% endblock %}

{% load static from staticfiles %}
{% load process_tags %}
{% load rest_framework %}

{% block pageTitle %}User View {{ app_name }}{% endblock %}

{% block content  %}
<style type="text/css">

.table-condensed>thead>tr>th, .table-condensed>tbody>tr>th, .table-condensed>tfoot>tr>th, .table-condensed>thead>tr>td, .table-condensed>tbody>tr>td, .table-condensed>tfoot>tr>td {
   padding: 5px 8px;
}
.reimburse-action-button{width: 30px;border-radius: 25px;}

</style>

<link href="/static/plugins/dataTables/css/dataTables.bootstrap.css" rel="stylesheet" type="text/css">
<link href="/static/bootstrap3_datetime/css/bootstrap-datetimepicker.min.css" type="text/css" media="all" rel="stylesheet" />
    <script type="text/javascript" src="/static/bootstrap3_datetime/js/moment.min.js"></script>
<script type="text/javascript" src="/static/bootstrap3_datetime/js/bootstrap-datetimepicker.min.js"></script>

     <div class="panel pb-15">
                  <div class="panel-heading vd_bg-grey clearfix">
                    <h2 class="panel-title pull-left" style="font-size: 15px;line-height: 30px">Basic List Group</h2>
                    <select class="form-control input-sm pull-right hidden" style="width: auto">
                      <option>2017</option>
                      <option>2016</option>
                      <option>2015</option>
                    </select>
                  </div>

    <div class="panel-body">

     <div class="row" style="margin-bottom: -20px"><a id="{{ app_name }}" href="#modal-container-process_raise" data-toggle="modal" title="Raise Request" class="btn btn-sm btn-success pull-right" style="margin-bottom: 10px; margin-right: 25px">{{ app_name }} Raise</a></div>

                    <ul class="nav nav-tabs">
                      <li class="active"><a href="#tab1" data-toggle="tab">Active</a></li>
                      <li><a href="#tab2" data-toggle="tab">Approved</a></li>
                      <li><a href="#tab3" data-toggle="tab">Cancelled</a></li>
                    </ul>
                    <br/>
                    <div class="tab-content mgbt-xs-20">
                      <div class="tab-pane active" id="tab1">
                        <table class="table table-striped reimburse-table myansr-table" id="data-tables">
                          <thead>
                            <tr>
                                <th><b>S. No</b></th>
                                {% for field in fields %}
                                        {% if field != 'id' %}
                                   <th><b>{{ field|transaction_name_split }}</b></th>
                                    {% endif %}
                                {% endfor %}
                                <th><b>Action</b></th>
                            </tr>
                          </thead>
                          <tbody>
                        {% for process in queryset.active %}
                             <tr>
                                 <td><a id="{{ app_name }}-{{ process| field_name:"id" }}-user"
                                            href="#modal-container-Detail" data-toggle="modal" title="Details"
                                            class="pull-right ">
                                                    {{ forloop.counter }}
                                                  </a></td>
                         {% for field in fields %}
                             {% with fields_val=process|field_name:field  %}
                             {% if field == "id" %}
                                 {% elif field == 'attachment' and  fields_val %}
                                 <td class="ws-mw">
                                 <div class="" >
         <!-- Attachments start -->

                   <a target="_blank" href="{{ fields_val }}">
                       Attachment
                   </a>

                 </div>
                                 </td>
                                {% else %}
                              <td class="ws-mw">{{ fields_val }}</td>
                             {% endif %}

{% endwith %}
                        {% endfor %}
                            <th>
                             <a id="{{ app_name }}-{{ process| field_name:"id" }}" onclick="delete_process()" data-toggle="modal" title="Delete" class="reimburse-action-button pull-right btn btn-sm btn-success ansr_red the-right-button text-center"><i class="fa fa-times append-icon"></i></a>
                             <a id="{{ app_name }}-{{ process| field_name:"id" }}" href="#modal-container-process_update" data-toggle="modal" title="Update" class="reimburse-action-button pull-right btn btn-sm btn-primary text-center"><i class="fa fa-pencil-square-o"></i></a>
                            </th>
                        </tr>

                        {% endfor %}

                        </table>

                      </div><!-- ./tab -->
                      <div class="tab-pane" id="tab2">
                          <table class="table table-striped reimburse-table myansr-table" id="data-tables_1">
                          <thead>
                            <tr>
                                <th><b>S. No</b></th>
                                {% for field in fields %}

                                  {% if field != 'id' %}

                                   <th><b>{{ field|transaction_name_split }}</b></th>
                                    {% endif %}


                                {% endfor %}

                            </tr>
                          </thead>
                          <tbody>
                        {% for process in queryset.inactive %}
                             <tr>
                                 <td><a id="{{ app_name }}-{{ process| field_name:"id" }}-user"
                                            href="#modal-container-Detail" data-toggle="modal" title="Details"
                                            class="pull-right ">
                                                    {{ forloop.counter  }}
                                                  </a></td>
                         {% for field in fields %}

                             {% if field == "id" %}
                                 {% elif field == 'attachment' %}
                                 <td class="ws-mw">
                                 <div class="" >
         <!-- Attachments start -->
                 <a target="_blank" href="{{process| field_name:field }}">
                       Attachment
                   </a>
                 </div>
                                 </td>
                                {% else %}
                              <td class="ws-mw">{{ process| field_name:field }}</td>
                             {% endif %}


                        {% endfor %}


                        </tr>

                        {% endfor %}

                        </table>
                      </div><!-- ./tab -->
                      <div class="tab-pane" id="tab3">
                          <table class="table table-striped reimburse-table" id="data-tables_2">
                          <thead>
                            <tr>
                                <th><b>S. No</b></th>
                                {% for field in fields %}
                                    {% if field != 'id' %}

                                   <th><b>{{ field|transaction_name_split }}</b></th>
                                    {% endif %}
                                {% endfor %}

                            </tr>
                          </thead>
                          <tbody>
                        {% for process in queryset.rollback %}
                             <tr>
                                  <td><a id="{{ app_name }}-{{ process| field_name:"id" }}-user"
                                            href="#modal-container-Detail" data-toggle="modal" title="Details"
                                class="pull-right ">
                                                    {{ forloop.counter }}
                                                  </a></td>
                         {% for field in fields %}

                             {% if field == "id" %}
                                 {% elif field == 'attachment' %}
                                 <td class="ws-mw">
                                 <div class="" >
         <!-- Attachments start -->
                 <a target="_blank" href="{{process| field_name:field }}">
                       Attachment
                   </a>
                 </div>
                                 </td>
                                {% else %}
                              <td class="ws-mw">{{ process| field_name:field }}</td>
                             {% endif %}


                        {% endfor %}


                        </tr>

                        {% endfor %}

                        </table>
                      </div><!-- ./tab -->
                    </div>




</div>
     </div>



<div class="modal fade" id="modal-container-process_raise" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                          <form method="POST" id="process_create" enctype="multipart/form-data" >
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">

                            <button  type="button" class="close" data-dismiss="modal" aria-hidden="true">
								x
							</button>

                            <h4 class="modal-title" id="myModalLabel">
								RAISING REQUEST
							</h4>
                        </div>
                        <div class="modal-body min-height-400" id="modal_body">
    {% csrf_token %}
    {% render_form serializer template_pack='rest_framework/vertical' %}
<br style="clear:both"><input type="submit" class="btn vd_btn vd_bg-green" value="Raise">

                        </div>
                    <div class="modal-footer background-login">
                          <!-- <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button> -->

                          </div>
                    </div><!-- ./modal-footer -->

                </div>

</form>
            </div>


    <div class="modal fade" id="modal-container-process_update" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">

                            <button  type="button" class="close" data-dismiss="modal" aria-hidden="true">
								x
							</button>

                            <h4 class="modal-title" id="myModalLabel">
								Update Process
							</h4>
                        </div>
                        <div class="modal-body min-height-400" id="modal_body_update">


                        </div>
                    <div class="modal-footer background-login">
                          <!-- <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button> -->
{#                          <input type="submit" class="btn vd_btn vd_bg-green" value="U">#}
                          </div>
                    </div><!
                    </div><!-- ./modal-footer -->

                </div>

            </div>

<div class="modal fade" id="modal-container-Detail" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">

                            <button  type="button" class="close" data-dismiss="modal" aria-hidden="true">
								x
							</button>

                            <h4 class="modal-title" id="myModalLabel">
								DETAIL
							</h4>
                        </div>
                        <div class="modal-body min-height-400" id="modal_body_detail">
                          <img src="/static/images/ajax-loader.gif">
                        </div>
                    <div class="modal-footer background-login">
                          <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button>
                        </div>
                    </div><!-- ./modal-footer -->

                </div>

            </div>

<script type="text/javascript" src="/static/plugins/dataTables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/static/js/dataTables.bootstrap.js"></script>

{#<script src='{% static 'js/customapp.js' %}' type="text/javascript"></script>#}

<script type="text/javascript">

$('document').ready(function(){
  $('#data-tables').dataTable();
  $('#data-tables_1').dataTable();
  $('#data-tables_2').dataTable();
});
$(".attachment").change(function(){
   var filename = $(this).val();
   var re = /(\.jpg|\.jpeg|\.gif|\.GIF|\.png)$/i;
   if(!re.exec(filename)){
       alert("File extension not supported");
       $(".attachment")[0].val('');
   }

});

$('form#process_create').submit(function(e){
    var formData = new FormData($(this)[0]);
						 form_id = $(this)[0].id;
						 form_element = $(this);

						 swal({   title: "Are you sure?",
							text: "Do you want to submit your {{ app_name }} process ?",
							type: "warning",
							showCancelButton: true,
							confirmButtonColor: "#DD6B55",
							confirmButtonText: "Yes, Submit it!",
							cancelButtonText: "No, cancel it.",
							closeOnConfirm: true,
							closeOnCancel: true
							},
							function(isConfirm){
								if (isConfirm) {

								 $.ajax({
									url: "/process/{{ app_name }}/create/",
									type: 'post',
									data: formData,
									success: function (data) {
									    if (data.record_added) {
									        window.onbeforeunload = null;
                                            swal("Done!", data.success_msg, "success");
                                            $("#modal_body").html('');
                                            window.location = window.location;
                                        }
                                        else{
									        $("#modal_body").html(data);
                                        }


									},
									error: function(XMLHttpRequest, textStatus, errorThrown) {
									    console.log(XMLHttpRequest);
                                        console.log(textStatus);
                                        console.log(errorThrown);
												$("#process_create").html(XMLHttpRequest['responseText']);

											},
									cache: false,
									contentType: false,
									processData: false
								 });
								}
							   });
						 return false;
    e.preventDefault();
});
$("#modal-container-process_update").on('shown.bs.modal', function(e) {
      button = e.relatedTarget;
      button_details = button.id.split("-");

          $.ajax({
         type: "GET",
          url: '/process/'+ button_details[0] + '/get_process/' + button_details[1] + "/",


          success : function (data) {
              $("#modal_body_update").html(data);
          },
          error: function (XMLHttpRequest, textStatus, errorThrown) {
            $("#modal_body_update").html("<p style='color:red'>Oops! Something went wrong on the server. " +
                "The details are below: " + "<br>Status : "+ textStatus + "<br>Exception : "
                + errorThrown +
                "<br><br> Please take a screenshot of this message and send it to " +
                "<a href='mailto:myansrsourceHelpDesk@ansrsource.com'> MyAnsrSource Help Desk</a></p>");
          }
      });


  });

$("#modal-container-Detail").on('shown.bs.modal', function(e) {
      button = e.relatedTarget;
      button_details = button.id.split("-");

          $.ajax({
         type: "GET",
          url: '/process/'+ button_details[0] + '/update/' + button_details[1] + "/",
          data: {"action": button_details[2]},
          success : function (data) {
              $("#modal_body_detail").html(data);
          },
          error: function (XMLHttpRequest, textStatus, errorThrown) {
            $("#modal_body_detail").html("<p style='color:red'>Oops! Something went wrong on the server. " +
                "The details are below: " + "<br>Status : "+ textStatus + "<br>Exception : "
                + errorThrown +
                "<br><br> Please take a screenshot of this message and send it to " +
                "<a href='mailto:myansrsourceHelpDesk@ansrsource.com'> MyAnsrSource Help Desk</a></p>");
          }
      });


  });

function delete_process(){
{#    button = $(this).attr('id');#}
    button = event.target.id;
      button_details = button.split("-");
    swal({   title: "Are you sure?",
							text: "Do you want to delete your {{ app_name }} process request?",
							type: "warning",
							showCancelButton: true,
							confirmButtonColor: "#DD6B55",
							confirmButtonText: "Yes, Submit it!",
							cancelButtonText: "No, cancel it.",
							closeOnConfirm: true,
							closeOnCancel: true
							},
							function(isConfirm){
								if (isConfirm) {

								 $.ajax({
									url: '/process/'+ button_details[0] + '/update/' + button_details[1] + "/",
									type: 'DELETE',
									success: function () {

											 swal("Done!", "Process deleted", "success");
                                        window.location=window.location;


									},
									error: function(XMLHttpRequest, textStatus, errorThrown) {
												$("#modal_body_update").html("Oops! Something went wrong on the server. The details are below: "
													+ "<br>Status : "+ textStatus + "<br>Exception : " + errorThrown + "<br><br> Please take a screenshot of this message and send it to <a href='mailto:myansrsourceHelpDesk@ansrsource.com'> MyAnsrSource Help Desk</a>.");

											},
									cache: false,
									contentType: false,
									processData: false
								 });
								}
							   });
}


$(".datepicker").datetimepicker({"pickTime": false, "language": "en", "format": "YYYY-MM-DD"});
</script>

{% endblock %}