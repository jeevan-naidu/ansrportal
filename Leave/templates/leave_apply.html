{% load bootstrap3 %}
{% load fontawesome %}
{% load static from staticfiles %}

{% if record_added %}
<h4> Success</h4>
{% else %}


			<!-- Ajax -->
		 <div id="ajax_loader_apply_leave" class="ajax_bck"><div class="ajax_load_image"></div></div>
		 <form id="modal-container-252304" class="form-horizontal" method="post" enctype="multipart/form-data">

		  {% csrf_token %}
			<div style="color:red" id="LeaveForm_errors"></div><br>
					{% for field in form.visible_fields %}

					{% if  forloop.counter == 3 or forloop.counter == 5%}

					{%else%}
				 <div class="form-group">
						{% endif %}

						{% if  forloop.counter == 1 and leave_count %}
						{%else%}

 						 {% endif %}

	 <label class="control-label col-sm-2 "label label-warning >{{ field.label_tag }} {% if field.field.required %}<span style="color:red;">*</span>{% endif %}</label>
	 {% if  forloop.counter == 3 or forloop.counter == 5 or forloop.counter == 2 or forloop.counter == 4 %}
	 				{% if  form.fields|length > 5 %}
	 				<div class="col-sm-4">
		 				{%else%}
						<div class="col-sm-10">
						{% endif %}
	 {%else%}
	 {% if  forloop.counter == 1 and leave_count %}
	 <div class="col-sm-4">
	 {%else%}
<div class="col-sm-10">
		{% endif %}

		 {% endif %}
		 {{ field }}{% if field.help_text %} {{ field.help_text }} {% endif %}
			 {% if field.errors %}<p style="color:red;">{{ field.errors|striptags }}</p>{% endif %}
	 </div>
	 {% if  forloop.counter == 2 or forloop.counter == 4%}
	 {% else %}

 {% if  forloop.counter == 1 and leave_count %}
 <label class="control-label col-sm-2 label label-warning" >Avaliable leave {{leave_count}}</label>
 </div>
 {%else%}
</div>
	{% endif %}
 {% endif %}
 {% endfor %}
 <div class="form-group">
	 <div class="col-sm-offset-2 col-sm-10">
		 <button type="submit" class="btn btn-success">Apply Leave</button>
	 </div>
 </div>
 {% if errors %}
 <div class="form-group">
	<div class="col-sm-offset-2 col-sm-10">
		{% for non_field_error in errors %}
		<div style="color:red;"><h5> {{non_field_error}}</h5></div>
		{% endfor %}

	 {% endif %}
	 {% for field in form.hidden_fields %}
		 {{field}}
	 {% endfor %}
	</div>
 </div>
</form>


	{% endif %}
		   <script>
			 $(document).ready(function() {
    //$('#id_leave').val("sick_leave")
});
			 $('#id_leave').change(function(){
				 var selectedLeave = $('#id_leave option:selected').val()
				 if(selectedLeave == 'maternity_leave' || selectedLeave == 'paternity_leave' || selectedLeave == 'bereavement_leave' || selectedLeave == 'comp_off_apply' || selectedLeave == 'comp_off_avail')
				 {
					 $.ajax(
													 {
															 type : "GET",
															 url : '/leave/add/',
															 data :{leavetype: selectedLeave} ,
															 success : function(data)
															 {
																	 $("#modal_body").html(data);

															 },
															 error: function(XMLHttpRequest, textStatus, errorThrown) {
															 $("#modal_body").html("<p style='color:red'>Oops! Something went wrong on the server. The details are below: "
																	 + "<br>Status : "+ textStatus + "<br>Exception : " + errorThrown + "<br><br> Please take a screenshot of this message and send it to <a href='mailto:myansrsourceHelpDesk@ansrsource.com'> MyAnsrSource Help Desk</a></p>");
															 HideAjaxLoader(ajax_loader_element);
															 },
													 }
											 );

										 }
										 else{
											$.ajax(
																			{
																					type : "GET",
																					url : '/leave/add/',
																					data :{leavetype: selectedLeave} ,
																					success : function(data)
																					{
																							$("#modal_body").html(data);

																					},
																					error: function(XMLHttpRequest, textStatus, errorThrown) {
																					$("#modal_body").html("<p style='color:red'>Oops! Something went wrong on the server. The details are below: "
																							+ "<br>Status : "+ textStatus + "<br>Exception : " + errorThrown + "<br><br> Please take a screenshot of this message and send it to <a href='mailto:myansrsourceHelpDesk@ansrsource.com'> MyAnsrSource Help Desk</a></p>");
																					HideAjaxLoader(ajax_loader_element);
																					},
																			}
																	);
																	$('#id_leave').val("selectedLeave")//.attr("selected", "selected");
						}
			 });

			 reloadJS();
				 // File size validation
				var fileExtension = ['jpg', 'csv','png', 'pdf', 'xlsx', 'xls', 'docx', 'doc', 'jpeg', 'eml'];
				$('.filestyle').bind('change', function() {
				if (this.files[0].size > 1000000) {
					alert("File size greater than 1MB not allowed");
					$(this).filestyle('clear');
				}
				else
				{
					if ($.inArray($(this).val().split('.').pop().toLowerCase(), fileExtension) == -1) {
                    alert("Allowed file types : "+fileExtension.join(', '));
                    $(this).filestyle('clear');
                }
				}

				});

				  $("form#modal-container-252304").submit(function(){

						 var formData = new FormData($(this)[0]);
						 form_id = $(this)[0].id;
						 form_element = $(this);
						ajax_loader_element = $('#ajax_loader_apply_leave');

						 swal({   title: "Are you sure?",
							text: "You want to submit your leave!",
							type: "warning",
							showCancelButton: true,
							confirmButtonColor: "#DD6B55",
							confirmButtonText: "Yes, Submit it!",
							cancelButtonText: "cancel",
							closeOnConfirm: true,
							closeOnCancel: true
							},
							function(isConfirm){
								// If user clicks on ok;
								if (isConfirm) {

								 ShowAjaxLoader(ajax_loader_element, form_element.width(), form_element.height());
								 $.ajax({
									url: "/leave/add/",
									type: 'post',
									data: formData,
									success: function (data) {
									   if (data.record_added) {
										  $("#modal_body").html("<h5 style='color:green;'>" + data.success_msg + "</h5>");
										  if ($("#listTableBody tr:first").length) {
											$("#listTableBody tr:first").before(data.html_data);

											// reload the js for file for ajax requests
												window.location.reload();
												window.opener.location.reload();

										   }
										  else{
											 $("#listTableBody").append(data.html_data);
											 $("#no_grievances_alert").hide();
										  }
										  $("#listTableBody tr:first").hide();
										  $("#listTableBody tr:first").fadeIn(900);

										 }
									   else{
										$("#modal_body").html(data);
									   }
										HideAjaxLoader($('#ajax_loader_apply_leave'));

										// reloadJS();
									},
									error: function(XMLHttpRequest, textStatus, errorThrown) {
												$("#LeaveForm_errors").html("Oops! Something went wrong on the server. The details are below: "
													+ "<br>Status : "+ textStatus + "<br>Exception : " + errorThrown + "<br><br> Please take a screenshot of this message and send it to <a href='mailto:myansrsourceHelpDesk@ansrsource.com'> MyAnsrSource Help Desk</a>.");
												HideAjaxLoader(ajax_loader_element);
											},

									cache: false,
									contentType: false,
									processData: false
								 });
								}
							   });

						 return false;
					 });

					 $(function () {
							 $('#id_toDate_pickers').datetimepicker({
								 format: 'YYYY-MM-DD',
								 "autoclose" : true,


							 });
							 $('#id_fromDate_pickers').datetimepicker({
								 format: 'YYYY-MM-DD'

							 });


	});







					 function reloadJS(){
			                 // reload the js for file field for ajax requests

			                //  $.getScript( "/static/js/jquery.ui.widget.js", function( data, textStatus, jqxhr ) {
			                //  	console.log( textStatus ); // Success
			                //  console.log( jqxhr.status ); // 200
			                //  });
											 //
			                //  // reload the js for file field for ajax requests
			                //  $.getScript( "/static/js/bootstrap-filestyle.min.js", function( data, textStatus, jqxhr ) {
			                //  console.log( textStatus ); // Success
			                //  console.log( jqxhr.status ); // 200
			                //  });
											 //
											 //
											//  $.getScript( "/static/bootstrap3_datetime/js/bootstrap-datetimepicker.min.js", function( data, textStatus, jqxhr ) {
			                //  console.log( textStatus ); // Success
			                //  console.log( jqxhr.status ); // 200
			                //  });

											//  $.getScript( "/static/bootstrap3_datetime/js/moment.min.js", function( data, textStatus, jqxhr ) {
			                //  console.log( textStatus ); // Success
			                //  console.log( jqxhr.status ); // 200
			                //  });
			     }
			  </script>
