{% extends 'master.html' %}
{% load bootstrap3 %}
{% load fontawesome %}
{% load static from staticfiles %}
{% block siteTitle %}Leave Dashboard{% endblock %}
{% block pageTitle %}Leave Report{% endblock %}
{% block content  %}


<link href="/static/plugins/morris/morris.css" rel="stylesheet" type="text/css">
<link href="/static/plugins/dataTables/css/dataTables.bootstrap.css" rel="stylesheet" type="text/css">

<div class="row">
<div id="user-leave-report">
              <div class="col-sm-7">

                <div class="panel">


                  <div class="panel-body table-responsive jsh3">

                  <div class="row">

                    <div class="col-sm-12">


                      <div class="btn-group">
                        <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">Select Month<i class="fa fa-caret-down prepend-icon"></i> </button>
                        <ul class="dropdown-menu" role="menu">

                          <li><a onclick="monthchange(1)">January</a></li>
                          <li><a onclick="monthchange(2)">February</a></li>
                          <li><a onclick="monthchange(3)">March</a></li>
                          <li><a onclick="monthchange(4)">April</a></li>
                          <li><a onclick="monthchange(5)">May</a></li>
                          <li><a onclick="monthchange(6)">June</a></li>
                          <li><a onclick="monthchange(7)">July</a></li>
                          <li><a onclick="monthchange(8)">August</a></li>
                          <li><a onclick="monthchange(9)">September</a></li>
                          <li><a onclick="monthchange(10)">October</a></li>
                          <li><a onclick="monthchange(11)">November</a></li>
                          <li><a onclick="monthchange(12)">December</a></li>

                        </ul>
                      </div>


                      <div class="btn-group">
                        <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">Select Week<i class="fa fa-caret-down prepend-icon"></i> </button>
                        <ul class="dropdown-menu" role="menu">
                            {% for val in  weekreport%}
                          <li><a onclick="weekchange({{ forloop.counter }}, {{ month }})">Week {{ forloop.counter }}</a></li>
                            {% endfor %}

                        </ul>
                      </div>


                      <div class="btn-group">
                        <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">Select Team<i class="fa fa-caret-down prepend-icon"></i> </button>
                        <ul class="dropdown-menu" role="menu">
                          <li><a href="#">My Team</a></li>
                          <li><a href="#">My Peers</a></li>
                        </ul>
                      </div>


                      <div class="inline-block font-bold pull-right month-week">{{ startdate }} - {{ enddate}}</div>

                    </div>


                  </div>
                    <hr style="margin-top: -10px;margin-bottom: 10px;">

                    <table class="table  table-striped leave-report-table" id="data-tables">
                      <thead>
                        <tr>
                          <th>Person  ({{ leavereport|length }})</th>
                          <th>Mon</th>
                          <th>Tue</th>
                          <th>Wed</th>
                          <th>Thu</th>
                          <th>Fri</th>
                        </tr>
                      </thead>
                      <tbody>
                 {% for person in leavereport%}

                        <tr class="gradeX">
                          <td>{{ person.0 }}</td>
                            {% for val1 in  person.1%}
                                {% if val1 == 0 %}
                                    <td><div class="indicator"></div></td>
                                {% elif val1 == 1 %}
                                    <td><div class="indicator half-day"></div></td>
                                {% elif val1 == 2 %}
                                    <td><div class="indicator absent"></div></td>
                                {% elif val1 == 3 %}
                                    <td><div class="indicator holiday"></div></td>
                                {% endif %}

{% endfor %}


                        </tr>
                        {% endfor %}





                      </tbody>
                      <tfoot>
                        <tr class="gradeX">
                          <td>The sum</td>
                          <td class="text-center" id="mon-total">0</td>
                          <td class="text-center" id="tue-total">0</td>
                          <td class="text-center" id="wed-total">0</td>
                          <td class="text-center" id="thr-total">0</td>
                          <td class="text-center" id="fri-total">0</td>
                        </tr>
                      </tfoot>
                    </table>

                  </div>
                </div>


              </div><!-- ./col-sm -->

</div>

<div id="monthly-leave-report">
              <div class="col-md-5 mgbt-xs-20 mgbt-md-0">
                <div class="panel widget  light-widget">
                  <div class="panel-body-list jsh4">
                    <p class="pd-25 inline-block" style="padding-bottom: 10px !important">Available :<span class="font-semibold legend-available"><span class="lr-invisible">0</span></span> </p>
                    <p class="pd-25 inline-block" style="padding-bottom:10px !important; padding-left: 0px !important;">Holidays :<span class="font-semibold legend-holiday"><span class="lr-invisible">0</span></span> </p>
                  <p class="pd-25 inline-block" style="padding-bottom:10px !important; padding-left: 0px !important;">Holidays :<span class="font-semibold legend-absent"><span class="lr-invisible">0</span></span> </p>
<!-- Bar chart -->
                    <div id="bar-placeholder" class="bar-chart" style="height: 300px"></div>

                    <div class="col-sm-12 pd-25">

                    <h4>Leave Report Summary</h4>

                      <table class="lr-summary-table">
                          {% for val in  weekreport%}
                        <tr>
                          <td>Week {{ forloop.counter }}</td>
                          <td class="available">{{ val.available }}</td>
                          <td class="holiday">{{ val.holiday }}</td>
                          <td class="absent">{{ val.unavailable }}</td>
                        </tr>
                          {% endfor %}

                      </table>
                    </div>
                  </div>
                </div>
                <!-- col-md-6 -->
              </div><!-- ./col -->





</div>

</div><!-- ./row -->


<script type="text/javascript" src="/static/plugins/raphael/raphael.min.js"></script>
<script type="text/javascript" src="/static/plugins/morris/morris.min.js"></script>
<script type="text/javascript" src="/static/plugins/dataTables/jquery.dataTables.min.js"></script>

<script type="text/javascript">
  // The Bar Chart

  var barChart = function(){

    "use strict";

    window.barChart = Morris.Bar({
      element: 'bar-placeholder',
       data: [{% for val in  weekreport%}
      { y: 'Week {{ forloop.counter }}', a: {{ val.available }}, b: {{ val.unavailable }}, c: {{ val.holiday }} },
          {% endfor %}
      ],
      hideHover: 'always',
      stacked: true,
      xkey: 'y',
      ykeys: ['a', 'b', 'c'],
      labels: ['Series A', 'Series B', 'Series C'],
      barColors: ["#759273", "#acc1ab","#e8e8e8"]
    });

  }// Calling Bar Chart

  // End of Bar-Chart





    // Height Function



{#  var heightFunction2 = function(){#}
{#      hgt3=$('.jsh3').css('height');#}
{#      $('.jsh4').css('min-height', hgt3);#}
{#    }#}



$(document).ready(function() {
        "use strict";

        barChart();


        $('#data-tables').dataTable({
          searching: false,
          scrollCollapse: true
        });

        $(window).resize(function(){
          window.barChart.redraw();
          heightFunction2();
        });
    var mondayTotal = 0;
    var tuesdayTotal = 0;
    var wednesTotal = 0;
    var thursdayTotal = 0;
    var fridayTotal = 0;
    {% for person in leavereport%}
        {% if  person.1.0 == 0 %}
            mondayTotal += 1
        {% elif person.1.0 == 1 %}
            mondayTotal += .5
        {% endif %}

        {% if person.1.1 == 0 %}
            tuesdayTotal += 1
            {% elif person.1.0 == 1 %}
            tuesdayTotal += .5
        {% endif %}

        {% if person.1.2 == 0 %}
            wednesTotal += 1
            {% elif person.1.0 == 1 %}
            wednesTotal += .5
        {% endif %}

        {% if person.1.3 == 0 %}
            thursdayTotal += 1
        {% elif person.1.0 == 1 %}
            thursdayTotal += .5
        {% endif %}

         {% if person.1.4 == 0 %}
            fridayTotal += 1
         {% elif person.1.0 == 1 %}
            fridayTotal += .5
        {% endif %}
        console.log({{ person.1 }})
    {% endfor %}

    $("#mon-total").text(mondayTotal);
    $("#tue-total").text(tuesdayTotal);
    $("#wed-total").text(wednesTotal);
    $("#thr-total").text(thursdayTotal);
    $("#fri-total").text(fridayTotal);





});// End of document ready


// As td with person does not contain div, use div inside tr
function monthchange(month){
    weekchange(1, month);
      $.ajax({
          type: "GET",
                url: '/leave/monthwisedata/',
                data: {'month': month},
                success: function (data) {

                    $('#monthly-leave-report').text('');
                    $('#monthly-leave-report').append(data);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("<p style='color:red'>Oops! Something went wrong on the server. The details are below: "
                            + "<br>Status : " + textStatus + "<br>Exception : " + errorThrown + "<br><br> Please take a screenshot of this message and send it to <a href='mailto:myansrsourceHelpDesk@ansrsource.com'> MyAnsrSource Help Desk</a></p>");

                },
      });
  }

  function weekchange(week, month){
      $.ajax({
          type: "GET",
                url: '/leave/weekwisedata/',
                data: {'week': week, 'month':month},
                success: function (data) {
                    $('#user-leave-report').text('');
                    $('#user-leave-report').append(data);

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("<p style='color:red'>Oops! Something went wrong on the server. The details are below: "
                            + "<br>Status : " + textStatus + "<br>Exception : " + errorThrown + "<br><br> Please take a screenshot of this message and send it to <a href='mailto:myansrsourceHelpDesk@ansrsource.com'> MyAnsrSource Help Desk</a></p>");

                },
      });
  }

</script>



<style type="text/css">

/* Imported from site.min */

/* Leave Report */

.leave-report-table{margin-top: 0px !important;}
.leave-report-table div.indicator{
    background: #759273;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    margin: auto;
}
.table.leave-report-table tr>td, .table.leave-report-table tfoot{border: 1px solid #efefef;}
.table.leave-report-table tfoot, .table.leave-report-table td:last-child{background: #fdfdfd}

/*#bar-placeholder{margin-top: 10%}*/
div.indicator.absent{background-color: #e8e8e8;}
div.indicator.holiday{background-color: #acc1ab}
table.dataTable.leave-report-table thead .sorting{
    text-align: center;
}
.dataTables_length{display: none;}/* Removing number of entries to display */

.month-week{
  color: #733b3b;
  font-size: 14px;
/*  background: #ffd1d1;*/
  padding: 0px 10px;
  line-height: 30px;
  border-radius: 2px;
  cursor: default;
/*  border: 1px solid #733b3b;*/
}
[class*="legend"]{
    background: #e8e8e8;
    padding: 2px 15px;
    border-radius: 15px;
    margin-left: 5px;
    border: 1px solid #d4d4d4;
    color: #fff;
}
.legend-available{background: #759273;border-color: #5d805a;}
.legend-holiday{background: #acc1ab;border-color: #93af91;}

.lr-week-details{margin-bottom: 15px;}
.lr-week-details p{
  margin-bottom: 0px;
  margin-left: 15px;
}
.lr-summary-table{
  width: 100%;
  max-width: 500px;
  margin: auto;
}
.lr-summary-table td{
  width: 25%;
  border: 1px solid #e4e4e4;
  padding: 2px 5px;
}
.lr-summary-table td.available{text-align:center; background: #759273;}
.lr-summary-table td.holiday{text-align:center; background: #acc1ab;}
.lr-summary-table td.absent{text-align:center; background: #e8e8e8}
.inline-block{display: inline-block}

/* Added */

.jsh3{min-height: 400px;}
.lr-invisible{visibility: hidden}
</style>

{% endblock %}