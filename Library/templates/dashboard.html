{% extends 'master.html' %}
{% load bootstrap3 %}
{% load fontawesome %}
{% load static from staticfiles %}
{% block siteTitle %}Lend A Book{% endblock %}
{% block pageTitle %}Library{% endblock %}
{% block content  %}

<link href="/static/css/leave_style.css" rel="stylesheet" type="text/css">

     <div class="panel"><!-- row -->
            <div class="panel-body">
   <ul class="nav nav-tabs">
 <li data-toggle="tab"  data-target="#a" class="active"><a href="#">Avaliable Books</a></li>
  <li data-toggle="tab"  data-target="#b" ><a href="#">Lend History</a></li>
       {% if is_admin %}
  <li data-toggle="tab"  data-target="#c"  ><a href="#">ADMIN</a></li>
       {% endif %}
</ul>

 <div class="tab-content">
                              <div class="tab-pane active" id="a">
<br>
                <table class="table table-bordered table-hover mb-0 ansrgreen">
                    <tr class="Lv-ApproveTH ">
                        <th>Book Title</th>
                        <th>Author</th>
                        <th>Publisher</th>
                        <th>Action</th>
                    </tr>
                    {% for book in bookshelves %}
                    <tr>
                        <td>{{book.title}}</td>
                        <td>{{book.author.name}} {{book.author.surname}}</td>
                        <td>{{book.publisher.name}}</td>
                        <td>
                            {% if book.status == 'avaliable' %}
                                <button type="button" class="btn btn-primary btn-sm lend-book" id="{{book.id}}">Apply</button>
                            {% else %}
                            <button type="button" disabled class="btn btn-primary btn-sm ">Apply</button>
                            {% endif %}
                        </td>
                        </tr>
                    {% endfor %}


</table>
                                  </div>
      <div class="tab-pane fade" id="b">
          <br>
                <table class="table table-bordered table-hover mb-0 ansrgreen">
                    <tr class="Lv-ApproveTH ">
                        <th>Book Title</th>
                        <th>Author</th>
                        <th>Publisher</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                    {% for book in lendbook %}
                    <tr>
                        <td>{{book.book.title}}</td>
                        <td>{{book.book.author.name}} {{book.book.author.surname}}</td>
                        <td>{{book.book.publisher.name}}</td>
                    <td>{{book.status}}</td>
                    <td>
                            {% if book.status == 'approved' %}
                                <button type="button" class="btn btn-primary btn-sm return-book" id="{{book.id}}">Return</button>
                            {% else %}
                            <button type="button" disabled class="btn btn-primary btn-sm ">Return</button>
                            {% endif %}
                        </td>
                        </tr>
                    {% endfor %}


</table>
      </div>
  {% if is_admin %}
  <div class="tab-pane fade" id="c">
          <br>
                <table class="table table-bordered table-hover mb-0 ansrgreen">
                    <tr class="Lv-ApproveTH ">
                        <th>Applied By</th>
                        <th>Book Title</th>
                        <th>Author</th>
                        <th>Publisher</th>
                        <th>Action</th>
                    </tr>
                    {% for book in orderedbook %}
                    <tr>
                        <td>{{book.lend_by.first_name}} {{book.lend_by.last_name}}</td>
                        <td>{{book.book.title}}</td>
                        <td>{{book.book.author.name}} {{book.book.author.surname}}</td>
                        <td>{{book.book.publisher.name}}</td>
                    <td>

                                <button type="button" class="btn btn-primary btn-sm action-book" id="accept-{{book.id}}">Accept</button>

                            <button type="button"  class="btn btn-primary btn-sm action-book" id="reject-{{book.id}}">Reject</button>

                        </td>
                        </tr>
                    {% endfor %}


</table>
      </div>
 {% endif %}
     </div>

</div>
</div>
<script>
    $(".lend-book").click(function(){
        bookid= $(this)[0].id;
        console.log(bookid)
        $.ajax({
        url:'/library/bookrent/',
        data:{'bookid':bookid},
        type:'GET',
        success: function(data){
            if(data.is_added){
                swal("Done!", data.success_msg, "success");

                window.location.reload();
            }
            else{

            }
        }

        });
    });

$(".action-book").click(function(){
        bookid= $(this)[0].id;
        console.log(bookid)
        $.ajax({
        url:'/library/adminaction/',
        data:{'bookid':bookid},
        type:'GET',
        success: function(data){
            if(data.is_added){
                swal("Done!", data.success_msg, "success");
                window.location.reload();
            }
            else{

            }
        }

        });
    });
$(".return-book").click(function(){
        bookid= $(this)[0].id;
        console.log(bookid)
        $.ajax({
        url:'/library/bookreturn/',
        data:{'bookid':bookid},
        type:'GET',
        success: function(data){
            if(data.is_added){
                swal("Done!", data.success_msg, "success");

                window.location.reload();
            }
            else{

            }
        }

        });
    });
</script>
{% endblock %}