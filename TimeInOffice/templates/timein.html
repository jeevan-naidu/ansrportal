{% extends 'master.html' %}
{% load bootstrap3 %}
{% load fontawesome %}
{% load static from staticfiles %}
{% block siteTitle %}Time in Report{% endblock %}
{% block pageTitle %}Time in Report{% endblock %}
{% block content  %}


<link href="/static/plugins/morris/morris.css" rel="stylesheet" type="text/css">
<link href="/static/plugins/dataTables/css/dataTables.bootstrap.css" rel="stylesheet" type="text/css">

<div class="row">
<div id="user-leave-report">
              <div class="col-sm-12">

                <div class="panel">


                  <div class="panel-body table-responsive jsh3">

                  <div class="row">

                    <div class="col-sm-12">


                      <div class="btn-group mr-15">
                        <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">{{ month_in_english }}
                          <i class="fa fa-caret-down prepend-icon"></i>
                        </button>
                        <ul class="dropdown-menu" role="menu">

                          <li><a onclick="monthchange(1, 1)">January</a></li>
                          <li><a onclick="monthchange(1, 2)">February</a></li>
                          <li><a onclick="monthchange(1, 3)">March</a></li>
                          <li><a onclick="monthchange(1, 4)">April</a></li>
                          <li><a onclick="monthchange(1, 5)">May</a></li>
                          <li><a onclick="monthchange(1, 6)">June</a></li>
                          <li><a onclick="monthchange(1, 7)">July</a></li>
                          <li><a onclick="monthchange(1, 8)">August</a></li>
                          <li><a onclick="monthchange(1, 9)">September</a></li>
                          <li><a onclick="monthchange(1, 10)">October</a></li>
                          <li><a onclick="monthchange(1, 11)">November</a></li>
                          <li><a onclick="monthchange(1, 12)">December</a></li>

                        </ul>
                      </div>




                      <div class="btn-group">
                        <a onclick="monthchange({{ previous_week.0 }}, {{ previous_week.1 }})" id="lr-prev" class="btn btn-default btn-sm">
                          <span class="glyphicon glyphicon-arrow-left"></span>
                        </a>

                        <button type="button" class="btn btn-default btn-sm dropdown-toggle" id = "week-button" data-toggle="dropdown">
                          <span class="week-number">{{ week_in_english }} : </span><span class="week-range">{{ startdate }} - {{ enddate}}</span>
                          <i class="fa fa-caret-down prepend-icon"></i>
                        </button>

                        <a onclick="monthchange({{ next_week.0 }}, {{ next_week.1 }})" id="lr-next" class="btn btn-default btn-sm">
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>

                        <ul class="dropdown-menu" role="menu">
                            {% for val in  current_month_week_details%}
                              <li><a onclick="weekchange({{ forloop.counter }}, {{ month }})"><span class="week-number">
                                  Week {{ forloop.counter }} : </span><span class="week-range">{{ val.0 }} - {{ val.1}}</span></a></li>
                            {% endfor %}

                        </ul>
                      </div>


                      <!-- <div class="inline-block font-bold pull-right month-week">{{ startdate }} - {{ enddate}}</div> -->

                    </div>


                  </div>
                    <hr style="margin-top: -10px;margin-bottom: 10px;">

                    <table class="table  table-striped leave-report-table" id="data-tables">
                      <thead>
                        <tr>
                          <th>Person  ({{ timereport|length }})</th>
                          <th>Mon</th>
                          <th>Tue</th>
                          <th>Wed</th>
                          <th>Thu</th>
                          <th>Fri</th>
                          <th>Average</th>
                        </tr>
                      </thead>

                      <tbody>

                 {% for person in timereport%}

                 <tr class="gradeX">
                          <td>{{ person.0 }}</td>
                            {% for val1 in  person.1%}
                        <td>{{ val1 }}</td>
                    {% endfor %}
                        <td>{{ person.2 }}</td>

                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>

                  </div><!-- ./panel-body -->

        <div id="lr-legend">
                      <button id="get-summary" class="btn btn-primary pull-right">Summary</button>
                    </div>
                </div><!-- ./panel -->


              </div><!-- ./col-sm -->

</div>

<div id="monthly-leave-report">
  <div class="col-md-12 mgbt-xs-20 mgbt-md-0">
    <div class="panel widget  light-widget">
      <div class="panel-body-list jsh4">
<!-- Bar chart -->



<!-- Spacer -->

<div class="col-lg-2 col-sm-1"></div>

<!-- Spacer -->

<div class="col-lg-2 col-sm-1"></div>

        <div class="col-lg-4 col-sm-5 pd-25" style="width:100%">


          <table class="table  table-striped leave-report-table" id="data-tables1">
<thead>     <h4>Monthly Data</h4>
              <tr>
              <th>Person</th>
              {% for val in weekreport %}
                <th> week {{ forloop.counter }}</th>
              {% endfor %}

            </tr>
</thead>
              <tbody>

                  {% for person in weekly_average%}
                <tr class="gradeX">
                  {% for val in person%}
                  <td>{{ val }}</td>
                  {% endfor %}
                </tr>
                  {% endfor %}
                </tbody>
          </table>
        </div>
      </div>
    </div>
    <!-- col-md-6 -->
  </div><!-- ./col -->





</div>

</div><!-- ./row -->


<script type="text/javascript" src="/static/plugins/raphael/raphael.min.js"></script>
<script type="text/javascript" src="/static/plugins/morris/morris.min.js"></script>
<script type="text/javascript" src="/static/plugins/dataTables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/static/js/dataTables.bootstrap.js"></script>

<script type="text/javascript">


{#  var heightFunction2 = function(){#}
{#      hgt3=$('.jsh3').css('height');#}
{#      $('.jsh4').css('min-height', hgt3);#}
{#    }#}



$(document).ready(function() {

        "use strict";

        $('#data-tables').dataTable({

        });

        $('#data-tables1').dataTable({

        });


    // Go to summary function

    $('#get-summary').click(function(){
      $('html, body').animate({scrollTop: 9999}, 'slow');
    })


});// End of document ready


// As td with person does not contain div, use div inside tr
function monthchange(week, month){
    weekchange(week, month);
      $.ajax({
          type: "GET",
                url: '/timein/monthwisedata/',
                data: {'month': month},
                success: function (data) {

                    $('#monthly-leave-report').text('');
                    $('#monthly-leave-report').append(data);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("<p style='color:red'>Oops! Something went wrong on the server. The details are below: "
                            + "<br>Status : " + textStatus + "<br>Exception : " + errorThrown + "<br><br> Please take a screenshot of this message and send it to <a href='mailto:myansrsourceHelpDesk@ansrsource.com'> MyAnsrSource Help Desk</a></p>");

                },
      });
  }

  function weekchange(week, month){
      $.ajax({
          type: "GET",
                url: '/timein/weekwisedata/',
                data: {'week': week, 'month':month},
                success: function (data) {
                    $('#user-leave-report').text('');
                    $('#user-leave-report').append(data);
                    $('#week-button span.week-number').text("Week " + week + " : ");

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("<p style='color:red'>Oops! Something went wrong on the server. The details are below: "
                            + "<br>Status : " + textStatus + "<br>Exception : " + errorThrown + "<br><br> Please take" +
                            " a screenshot of this message and send it to <a href='mailto:myansrsourceHelpDesk@ansrsource.com'>" +
                            " MyAnsrSource Help Desk</a></p>");

                },
      });
  }

</script>



<style type="text/css">

/* Imported from site.min */

/* Leave Report */

.leave-report-table{margin-top: 0px !important;}
.leave-report-table div.indicator{
    background: #55b439;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    margin: auto;
}
.table.leave-report-table tr>td, .table.leave-report-table tfoot{border: 1px solid #efefef;}
.table.leave-report-table tfoot{background: #fdfdfd}

/*#bar-placeholder{margin-top: 10%}*/
div.indicator.absent{background-color: #e95427;}
div.indicator.halfday{background-color: #b7efa7;}
div.indicator.holiday{background-color: #F4A460;}
table.dataTable.leave-report-table thead .sorting{
    text-align: left;
}
.dataTables_length{display: none;}/* Removing number of entries to display */

.month-week{
  color: #733b3b;
  font-size: 14px;
/*  background: #ffd1d1;*/
  padding: 0px 10px;
  line-height: 30px;
  border-radius: 2px;
  cursor: default;
/*  border: 1px solid #733b3b;*/
}

/* Bottom Section */

#lr-legend{background: #f9f9f9}

[class*="legend"]{
    background: #e8e8e8;
    padding: 2px 6px;
    border-radius: 15px;
    margin-left: 5px;
    border: 1px solid #d4d4d4;
    border: 1px solid #bfbfbf;
    color: #fff;
}
.legend-available{background: #55b439;border-color: #55b439;}
.legend-halfday{background: #b7efa7;border-color: #b7efa7;}
.legend-holiday{background: #F4A460;border-color:#F4A460;}
.legend-absent{background: #e95427;border-color: #e95427;}

.lr-week-details{margin-bottom: 15px;}
.lr-week-details p{
  margin-bottom: 0px;
  margin-left: 15px;
}
.lr-summary-table{
  width: 100%;
  max-width: 500px;
  /*margin: auto;*/
  text-align: center;
}
#data-tables1{
  align:left;
}
.lr-summary-table tr:first-child{
  background-color: #444444;
  color: #fff;
}
.lr-summary-table td{
  width: 25%;
  border: 1px solid #e4e4e4;
  padding: 2px 5px;
}
.lr-summary-table td.above9{text-align:center; background: #55b439;}
.lr-summary-table td.below6{text-align:center; background: #e95427;}
.lr-summary-table td.between68{text-align:center; background: #b7efa7;}
.lr-summary-table td.between89{text-align:center; background: #F4A460;}
.inline-block{display: inline-block}

.dropdown-menu a{cursor: pointer;}

#get-summary{margin:19px;}

.dropdown-menu>li>a:hover, .dropdown-menu>li>a:focus{background-color: #337ab7}
/* Added */

.jsh3{min-height: 400px;}
.lr-invisible{visibility: hidden}

/* Temp section - to be changed */

#data-tables_info{float: left;}
div.dataTables_paginate{margin-top: 10px;}

ul.dropdown-menu{z-index: 994} /* To be moved to main stylesheet */


</style>

{% endblock %}