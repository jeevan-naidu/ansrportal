
{% extends 'master.html' %}
{% block siteTitle %}Manage {{ app_name }}{% endblock %}

{% load static from staticfiles %}
{% load process_tags %}
{% load rest_framework %}

{% block pageTitle %}User View {{ app_name }}{% endblock %}

{% block content  %}


<link href="/static/plugins/dataTables/css/dataTables.bootstrap.css" rel="stylesheet" type="text/css">



     <div class="panel pb-15">
                  <div class="panel-heading vd_bg-grey clearfix">
                    <h2 class="panel-title pull-left" style="font-size: 15px;line-height: 30px">Basic List Group</h2>
                    <select class="form-control input-sm pull-right" style="width: auto">
                      <option>2017</option>
                      <option>2016</option>
                      <option>2015</option>
                    </select>
                  </div>
     <button type="button" class="btn btn-default">Raise {{ app_name }}</button>
     <a id="{{ app_name }}" href="#modal-container-process_raise" data-toggle="modal" title="Approve"
                                class="pull-right btn btn-sm btn-success">
                                                    {{ app_name }} Raise
                                                  </a>
    <div class="panel-body">
                    <ul class="nav nav-tabs">
                      <li class="active"><a href="#tab1" data-toggle="tab">Active</a></li>
                      <li><a href="#tab2" data-toggle="tab">Inactive</a></li>
                      <li><a href="#tab3" data-toggle="tab">Rollback</a></li>
                    </ul>
                    <br/>
                    <div class="tab-content mgbt-xs-20">
                      <div class="tab-pane active" id="tab1">
                        <table class="table table-striped" id="data-tables">
                          <thead>
                            <tr>
                                {% for field in fields %}

                                    {% if field == "request_status" %}
                        <th><b>Request Status</b></th>
                                    {% elif field == "id" %}
                                        {% else %}
                                        <th><b>{{ field|title }}</b></th>
                                    {% endif %}


                                {% endfor %}
                                <th><b>Action</b></th>
                            </tr>
                          </thead>
                          <tbody>
                        {% for process in queryset.active %}
                             <tr>
                         {% for field in fields %}
                             {% if field == "id" %}
                                {% else %}
                              <td>{{ process| field_name:field }}</td>
                             {% endif %}


                        {% endfor %}
                             <th><a id="{{ app_name }}-{{ process| field_name:"id" }}" href="#modal-container-process" data-toggle="modal" title="Approve"
                                class="pull-right btn btn-sm btn-success">
                                                    Delete
                                                  </a>
                                 <a id="{{ app_name }}-{{ process| field_name:"id" }}" href="#modal-container-process" data-toggle="modal" title="Approve"
                                class="pull-right btn btn-sm btn-success">
                                                    Update
                                                  </a>
                             </th>

                        </tr>

                        {% endfor %}

                        </table>

                      </div><!-- ./tab -->
                      <div class="tab-pane" id="tab2">
                          <table class="table table-striped" id="data-tables">
                          <thead>
                            <tr>
                                {% for field in fields %}

                                    {% if field == "request_status" %}
                        <th><b>Request Status</b></th>
                                    {% elif field == "id" %}
                                        {% else %}
                                        <th><b>{{ field|title }}</b></th>
                                    {% endif %}


                                {% endfor %}
                                <th><b>Action</b></th>
                            </tr>
                          </thead>
                          <tbody>
                        {% for process in queryset.inactive %}
                             <tr>
                         {% for field in fields %}
                             {% if field == "id" %}
                                {% else %}
                              <td>{{ process| field_name:field }}</td>
                             {% endif %}


                        {% endfor %}
                             <th><a id="{{ app_name }}-{{ process| field_name:"id" }}" href="#modal-container-process" data-toggle="modal" title="Approve"
                                class="pull-right btn btn-sm btn-success">
                                                    action
                                                  </a></th>

                        </tr>

                        {% endfor %}

                        </table>
                      </div><!-- ./tab -->
                      <div class="tab-pane" id="tab3">
                          <table class="table table-striped" id="data-tables">
                          <thead>
                            <tr>
                                {% for field in fields %}

                                    {% if field == "request_status" %}
                        <th><b>Request Status</b></th>
                                    {% elif field == "id" %}
                                        {% else %}
                                        <th><b>{{ field|title }}</b></th>
                                    {% endif %}


                                {% endfor %}
                                <th><b>Action</b></th>
                            </tr>
                          </thead>
                          <tbody>
                        {% for process in queryset.rollback %}
                             <tr>
                         {% for field in fields %}
                             {% if field == "id" %}
                                {% else %}
                              <td>{{ process| field_name:field }}</td>
                             {% endif %}


                        {% endfor %}
                             <th><a id="{{ app_name }}-{{ process| field_name:"id" }}" href="#modal-container-process" data-toggle="modal" title="Approve"
                                class="pull-right btn btn-sm btn-success">
                                                    action
                                                  </a></th>

                        </tr>

                        {% endfor %}

                        </table>
                      </div><!-- ./tab -->
                    </div>




</div>
     </div>



<div class="modal fade" id="modal-container-process_raise" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">

                            <button  type="button" class="close" data-dismiss="modal" aria-hidden="true">
								x
							</button>

                            <h4 class="modal-title" id="myModalLabel">
								RAISING REQUEST
							</h4>
                        </div>
                        <div class="modal-body min-height-400" id="modal_body">
                          <form method="POST" id="process_create">
    {% csrf_token %}
    {% render_form serializer template_pack='rest_framework/vertical' %}
    <input type="submit" class="btn btn-default" value="Raise">
</form>
                        </div>
                    <div class="modal-footer background-login">
                          <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button>
                        </div>
                    </div><!-- ./modal-footer -->

                </div>

            </div>

<script type="text/javascript" src="/static/plugins/dataTables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/static/js/dataTables.bootstrap.js"></script>

<script src='{% static 'js/custom_app.js' %}' type="text/javascript"></script>

<script type="text/javascript">

$('document').ready(function(){
  $('#data-tables').dataTable();
});
$('#process_create').submit(function(e){
    var formData = new FormData($(this)[0]);
						 form_id = $(this)[0].id;
						 form_element = $(this);

						 swal({   title: "Are you sure?",
							text: "Do you want to submit your {{ app_name }} process ?",
							type: "warning",
							showCancelButton: true,
							confirmButtonColor: "#DD6B55",
							confirmButtonText: "Yes, Submit it!",
							cancelButtonText: "No, cancel it.",
							closeOnConfirm: true,
							closeOnCancel: true
							},
							function(isConfirm){
								if (isConfirm) {

								 $.ajax({
									url: "/{{ app_name }}/create/",
									type: 'post',
									data: formData,
									success: function (data) {

											 swal("Done!", data.success_msg, "success");
											$("#modal_body").html('');
                                           window.location=window.location;


									},
									error: function(XMLHttpRequest, textStatus, errorThrown) {
												$("#LeaveForm_errors").html("Oops! Something went wrong on the server. The details are below: "
													+ "<br>Status : "+ textStatus + "<br>Exception : " + errorThrown + "<br><br> Please take a screenshot of this message and send it to <a href='mailto:myansrsourceHelpDesk@ansrsource.com'> MyAnsrSource Help Desk</a>.");

											},
									cache: false,
									contentType: false,
									processData: false
								 });
								}
							   });
						 return false;
    e.preventDefault();
});

</script>
{% endblock %}