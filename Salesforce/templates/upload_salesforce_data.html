{% extends 'master.html' %}
{% load sales_permissions %}
{% load bootstrap3 %}
{% load fontawesome %}
{% load static from staticfiles %}
{% load grievances_template_tags %}

{% block siteTitle %}Salesforce{% endblock %}
{% block pageTitle %}Salesforce Data{% endblock %}

{% block content  %}
<!--Start modal-->






<link href="/static/plugins/dataTables/css/dataTables.bootstrap.css" rel="stylesheet" type="text/css">



			<div class="modal fade" id="modal-container-992788" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header vd_bg-blue vd_white">
							 
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
								x
							</button>
							<h4 class="modal-title text-center" id="myModalLabel">
								Details
							</h4>
						</div>
						<div class="modal-body" id="modal-body">
							...
						</div>
						<div class="modal-footer vd_bg-grey">
						
						</div>
					</div>
					
				</div>
				
			</div>
			

<!--End modal-->













<h2 class="text-center hidden">Salesforce</h2>


{% if request.user|IsSalesforceAdmin %}

<div class="row">
	<div class="col-md-2"></div>
	<div class="col-md-8">
		<form action="/salesforce/upload-file/" method="post" enctype="multipart/form-data">
			{% csrf_token %}
			
			{% if errors_list %}
				<h4>Below errors were found in csv:</h4>
				{% for error in errors_list %}
					<!--<h5 style="color: red;">Exception Type : {{exception_type}}<br>
					Exception : {{exception}}<br>
					Line No : {{error_at_line}}
					</h5>-->
					<h5 style="color: red;">{{error}}</h5>
				{% endfor %}

			{% endif %}
			{% for field in form %}
				<div class="fieldWrapper">
					
					<div class="col-sm-12">{{ field.label_tag }} {% if field.field.required %}<span style="color:red;">*</span>{% endif %}</div>
					<div class="col-sm-8">{{ field }}</div>
					<div class="col-sm-4">
						<button type="submit" class="btn btn-danger">Upload</button>
					</div> 
					<div class="col-sm-12">
						<span style="color:red;">{{ field.errors }}
						</span>
						{% if field.help_text %}
						<p class="help">{{ field.help_text|safe }}</p>
					</div>
					{% endif %}
				</div>
			{% endfor %}
		</form>
		
	</div>
	<div class="col-md-2"></div>
</div>

{% endif %}

<div class="panel clearfix">
<div class="panel-body">
<h4 class="pull-right">Total : {{salesforce_data_list|length}}</h4>
<table class="table  table-striped leave-report-table" id="data-tables">
    <thead>
      <tr>
		<th class="text-center">No.</th>
        <th class="text-center">SF No.</th>
        <th class="text-center">Opportunity Name</th>
        <th class="text-center">Value</th>
		<th class="text-center" style="min-width:100px">Start Date</th>
          <th class="text-center" style="min-width:100px">End Date</th>
      </tr>
    </thead>
    <tbody>
	{% for obj in salesforce_data_list %}
      <tr>
		<td>{{forloop.counter}}</td>
        <td>
			<a style="padding:0px 2px;" href="#modal-container-992788" role="button" class="btn opp_num" data-toggle="modal">{{obj.opportunity_number}}</a>
			<div style="display: none">
				<table class="table table-striped">
					<tr>
						<td>SF/Opportunity N0</td>
						<td>:{{obj.opportunity_number}}</td>
					</tr>
					<tr>
						<td>Opportunity Name</td>
						<td>:{{obj.opportunity_name}}</td>
					</tr>
					<tr>
						<td>Business Unit</td>
						<td>:{{obj.business_unit}}</td>
					</tr>
					<tr>
						<td>Customer Contact</td>
						<td>:{{obj.customer_contact}}</td>
					</tr>
					<tr>
						<td>Account Name</td>
						<td>:{{obj.account_name}}</td>
					</tr>
					<tr>
						<td>Value</td>
						<td>:{{obj.value|floatformat:2}}</td>
					</tr>
					<tr>
						<td>Probability</td>
						<td>:{{obj.probability}}</td>
					</tr>
					<tr>
						<td>Start Date</td>
						<td>:{{obj.start_date}}</td>
					</tr>
					<tr>
						<td>End Date</td>
						<td>:{{obj.end_date}}</td>
					</tr>
					<tr>
						<td>Status</td>
						<td>:{{obj.status}}</td>
					</tr>
					<tr>
						<td>Updated Date</td>
						<td>:{{obj.updated_date}}</td>
					</tr>
					<tr>
						<td> Created Date</td>
						<td>:{{obj.created_date}}</td>
					</tr>
				</table>
			</div>
		</td>
        <td>{{obj.opportunity_name}}</td>
        <td class="text-right">{{obj.value|floatformat:2}}</td>
		<td>{{obj.start_date}}</td>
      <td>{{obj.end_date}}</td>
      </tr>
	{% endfor %}
     
    </tbody>
  </table>

<!-- <h4 class="pull-right">Total : {{salesforce_data_list|length}}</h4> -->

</div>



</div>



<style type="text/css">
	
.input-group-btn .btn {
    padding: 6px 12px;
}
div.dataTables_filter label{float: left !important;}	
</style>







{% endblock  %}

{% block page_specific_JS %}
		<script src='/static/js/jquery.ui.widget.js' type="text/javascript"></script>
		<script src='/static/js/bootstrap-filestyle.min.js' type="text/javascript"></script>

		<script type="text/javascript" src="/static/plugins/dataTables/jquery.dataTables.min.js"></script>
		
		<script>
			$(document).ready(function(){

				// Data Tables Init

		        $('#data-tables').dataTable();








				$(".opp_num").click(function(){
					var details = $(this).next().html();
					$("#modal-body").html(details);
					});
				
					// File type validation
				var fileExtension = ['csv'];
				$('.filestyle').bind('change', function() {
				
					if ($.inArray($(this).val().split('.').pop().toLowerCase(), fileExtension) == -1) {
						alert("Allowed file types : "+fileExtension.join(', '));
						$(this).filestyle('clear');
						}
				
					
				});
				
				
				
				});
		</script>

{% endblock %}

