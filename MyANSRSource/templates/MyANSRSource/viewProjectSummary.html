{% extends 'viewProjectMaster.inc' %}

{% load fontawesome %}
{% block pageTitle %}View Project Summary{% endblock %}
{% block PSactiveClass %}active{% endblock %}
{% block steps %}
    {% if show_header %}
        {{ block.super }}
    {% else %}
    {% endif %}
{% endblock %}

{% block viewProjectContent %}
<legend><b>Summary</b>
    <span class="float-right"><h3><small><b>{{ basicInfo.projectId }} :  {{ basicInfo.name }}</b></small></h3></span>
</legend>
<div class="panel panel-default">
	<div class="panel-heading overflowHidden">
		<b>
			<span class="col-lg-6">Project Definition</span>
		</b>
	</div>
	<div class="panel-body">
	<table class="table table-condensed">
		<thead>
				<th>Type</th>
				<th>Business Unit</th>
				<th>Customer</th>
				<th>Customer Contact</th>
				<th>Book / Tile</th>
				<th>Is it an internal Project?</th>
				<th>Is this a new project?</th>
				<th>Is this contract signed?</th>
				<th>P.O.</th>
		</thead>
		<tbody>
		<tr>
			<td>{{ basicInfo.projectType__description }}</td>
			<td>{{ basicInfo.bu__name }}</td>
			<td>{{ basicInfo.customer__name }}</td>
			<td>{{ basicInfo.customerContact__username }}</td>
			<td>{{ basicInfo.book__name }}</td>
			<td>
				{% if basicInfo.internal == True  %}
					Yes
				{% else %}
					No
				{% endif %}
			</td>
			<td>
				{% if basicInfo.currentProject == True %}
					Yes
				{% else %}
					No
				{% endif %}
			</td>
			<td>
				{% if basicInfo.signed == True %}
					Yes
				{% else %}
					No
				{% endif %}
			</td>
			<td>{{ flagData.po }}</td>
		</tr>
		</tbody>
	</table>
	</div>
		<div class="panel panel-default">
	<div class="panel-heading overflowHidden">
		<b>
			<span class="col-lg-6">Project Additional detail</span>
		</b>
	</div>
			<div class="panel-body">
		<table class="table table-condensed">
		<thead>
				<th>Delivery manager</th>
				<th>Portfolio manager</th>
				<th>PM Delegate</th>
				<th>Project Finance Type</th>
                <th>Sow</th>
                <th>Estimation</th>
		</thead>
		<tbody>
		<tr>
			<td>{{ basicInfo.deliveryManager}}</td>
			<td>{{ basicInfo.portfolio_manager}}</td>
			<td>{{ basicInfo.pmDelegate }}</td>
			<td>{{ basicInfo.projectFinType }}</td>
            {% if basicInfo.Sowdocument %}
               <td><a href="/media/{{ basicInfo.Sowdocument }}" target="_blank"><span class="glyphicon glyphicon-file"></span></i></a></td>
            {% else %}
                <td>None</td>
            {% endif %}
            {% if basicInfo.Estimationdocument %}
                <td><a href="/media/{{ basicInfo.Estimationdocument }}" target="_blank"><span class="glyphicon glyphicon-file"></span></i></a></td>
            {% else %}
                <td>None</td>
            {% endif %}
		</tr>
		</tbody>
	</table>
	</div>
<div class="panel panel-default">
	<div class="panel-heading overflowHidden"><b><span class="col-lg-6">Project Basic Information</span></b></div>
	<div class="panel-body">
	<table class="table table-condensed">
		<thead>
				<th>Planned Effort</th>
				<th>Contigency Effort</th>
				<th>Start Date</th>
				<th>End Date</th>
				<th>Total Value</th>
				<th>Sales Opportuntiy Number</th>
		</thead>
		<tbody>
		<tr>
			<td>{{ flagData.plannedEffort }}</td>
			<td>{{ flagData.contingencyEffort }}</td>
			<td>{{ flagData.startDate }}</td>
			<td>{{ flagData.endDate }}</td>
			<td>{{ flagData.totalValue }}</td>
			<td>{{ flagData.salesForceNumber }}</td>
		</tr>
		</tbody>
	</table>
	</div>
</div>
<div class="panel panel-default">
	<div class="panel-heading overflowHidden">
		<b>
			<span class="col-lg-6">Team Member(s)</span>
		</b>
	</div>
<div class="panel-body">
	<table class="table table-condensed">
		<thead>
			<th>Member</th>
			<th>Start Date</th>
			<th>End Date</th>
			<th>Planned Effort</th>
			<th>%</th>
		</thead>
        {% if teamMember %}
		{% for teamData in teamMember %}
		<tr>
			<td>
				{{ teamData.member__username }}
			</td>
			<td>
				{{ teamData.startDate }}
			</td>
			<td>
				{{ teamData.endDate }}
			</td>
			<td>
				{{ teamData.plannedEffort }}
			</td>
			<td>
				{{ teamData.rate }}
			</td>
		</tr>
		{% endfor %}
        {% else %}
        <td colspan="6" class="text-center"><h4><small>No Updates in this section till now</small></h4></td>
        {% endif %}
	</table>
</div>
</div>

<div class="panel panel-default">
<div class="panel-heading overflowHidden"><b><span class="col-lg-6">Milestone(s) Invoice</span></b></div>
<div class="panel-body">
	<table class="table table-condensed">
		<thead>
			<th>Name</th>
			<th>Description</th>
			<th>Deadline</th>
			<th>Amount</th>
            <th>Completed</th>
			<th>Type</th>
		</thead>
        {% if milestone %}
		{% for milestoneData in milestone %}
		<tr>
			<td>
				{{ milestoneData.name }}
			</td>
			<td>
				{{ milestoneData.description }}
			</td>
			<td>
				{{ milestoneData.milestoneDate }}
			</td>
			<td>
				{{ milestoneData.amount }}
			</td>
            <td>
                {% if milestoneData.closed == True %}
				    <span class="glyphicon glyphicon-ok"></span>
			    {% endif %}
                {% if milestoneData.closed == False %}
                    <span class="glyphicon glyphicon-remove"></span>
			    {% endif %}

            </td>
			<td>

				{% if milestoneData.financial %}
                    Financial
                {% endif %}
			</td>
		</tr>
		{% endfor %}
        {% else %}
        <td colspan="3" class="text-center"><h4><small>No Updates in this section till now</small></h4></td>
        {% endif %}
		</table>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading overflowHidden"><b><span class="col-lg-6">Milestone(s) Revenue</span></b></div>
<div class="panel-body">
	<table class="table table-condensed">
		<thead>
			<th>Name</th>
			<th>Description</th>
			<th>Deadline</th>
			<th>Amount</th>
            <th>Completed</th>
			<th>Type</th>
		</thead>
        {% if milestoneDelivery %}
		{% for milestoneData in milestoneDelivery %}
		<tr>
			<td>
				{{ milestoneData.name }}
			</td>
			<td>
				{{ milestoneData.description }}
			</td>
			<td>
				{{ milestoneData.milestoneDate }}
			</td>
			<td>
				{{ milestoneData.amount }}
			</td>
            <td>
                {% if milestoneData.closed == True %}
                <span class="glyphicon glyphicon-ok"></span>
			    {% endif %}
                {% if milestoneData.closed == False %}
                   <span class="glyphicon glyphicon-remove"></span>
			    {% endif %}

            </td>
			<td>

				{% if not milestoneData.financial %}
                    Non-Financial
                {% endif %}
			</td>
		</tr>
		{% endfor %}
        {% else %}
        <td colspan="3" class="text-center"><h4><small>No Updates in this section till now</small></h4></td>
        {% endif %}
		</table>
</div>
</div>
<div class="panel panel-default">
	<div class="panel-heading overflowHidden"><b><span class="col-lg-6">Change History</span></b></div>
<div class="panel-body">
	<table class="table table-condensed">
		<thead>
      <th>CRId</th>
			<th>CR Date</th>
			<th>Revised Total</th>
      <th>Revised Effort</th>
      <th>Revised Start Date</th>
      <th>Revised End Date</th>
      <th>Signed</th>
      <th>Sow</th>
      <th>Estimation</th>
			<th>Closed</th>
			<th>Status</th>
		</thead>
        {% if changes %}
		{% for eachChange in changes %}
		<tr>
      <td class="ws-mw">
      <a id="{{eachChange.crId}}"
      href="#modal-container-detail" data-toggle="modal" title="Action"
     class="pull-left detail">
                         {{eachChange.crId}}
                       </a></td>
			<td>
				{{ eachChange.updatedOn }}
			</td>
			<td>
				{{ eachChange.revisedTotal }}
			</td>

			<td>
				{{ eachChange.revisedEffort }}
			</td>
      <td>
        {{ eachChange.startDate }}
      </td>

			<td>
				{{ eachChange.endDate }}
			</td>


			<td>
                {% if eachChange.signed %}
                       Yes
                {% else %}
                       No
                {% endif %}
			</td>
        {% if eachChange.Sowdocument %}
                <td>{{eachChange.Sowdocument}}</td>
        {% else %}
                <td>None</td>
        {% endif %}

        {% if eachChange.Estimationdocument %}
                <td>{{eachChange.Estimationdocument}}</td>
        {% else %}
                <td>None</td>
        {% endif %}
			<td>
                {% if eachChange.closed %}
                       Yes
                {% else %}
                       No
                {% endif %}
			</td>
			<td>{%if eachChange.approved == '0' %}Active{% endif %}{% if eachChange.approved == '1' %}Approved{% endif %}{% if eachChange.approved == '2' %} Rejected {% endif %} </td>
		</tr>
		{% endfor %}
        {% if closedOn %}
        <tr>
            <td colspan="6" class="text-center"><h4><small><b>Project Closed on {{ closedOn }}</b></small></h4></td>
        </tr>
        {% endif %}
        {% else %}
        <td colspan="6" class="text-center"><h4><small>No Updates in this section till now</small></h4></td>
        {% endif %}

	</table>
</div>
</div>

<div class="modal fade" id="modal-container-detail" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">

                            <button  type="button" class="close" data-dismiss="modal" aria-hidden="true">
								x
							</button>

                            <h4 class="modal-title" id="myModalLabel">
								DETAIL
							</h4>
                        </div>
                        <div class="modal-body min-height-400" id="modal_body">
                          <img src="/static/images/ajax-loader.gif">
                        </div>
                    <div class="modal-footer background-login">
                          <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button>
                        </div>
                    </div><!-- ./modal-footer -->

                </div>

            </div>

{% if show_header %}
<a href="view-project" class="btn btn-info">
        <i class="fa fa-arrow-circle-left"></i>
	<b>Choose another project</b>
</a> {% endif %}

<script type="text/javascript">
$(".detail").click(function(){
  var project_id = this.id
  $.ajax({
      url:"{% url 'change_request_detail' %}",
      data: {"id": project_id},
      type: "get",
      success: function(data){
      $("#modal_body").html(data);
      },
  });
});
</script>


 {% if not show_header %}


<script type="text/javascript">

$(function() {
       $('body').addClass("nav-left-hide remove-navbar nav-left-medium");

});

</script>

{% endif %}
{% endblock %}
