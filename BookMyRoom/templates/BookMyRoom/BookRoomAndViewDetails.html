  
  {% load book_my_room_template_tags %}
  <div class="panel panel-default clearfix room-booking-content">

    <div class="time-panel clearfix">

      <div class="col-sm-3"></div>
      <div class="col-sm-9 time-slots">

        <div class="col-sm-2">
            <span>8:00</span>
            <span>9:00</span>
        </div>

        <div class="col-sm-2">
            <span>10:00</span>
            <span>11:00</span>
        </div>
        <div class="col-sm-2">
            <span>12:00</span>
            <span>13:00</span>
        </div>
        <div class="col-sm-2">
            <span>14:00</span>
            <span>15:00</span>
        </div>
        <div class="col-sm-2">
            <span>16:00</span>
            <span>17:00</span>
        </div>
        <div class="col-sm-2">
            <span>18:00</span>
            <span>19:00</span>
        </div>

      </div>

    </div><!--end of time-panel-->


<div class="rooms-and-time clearfix">

<form id="BookMeetingForm" method="post" enctype="multipart/form-data">
		 <!--<form action="{% url 'add_grievance' %}" method="post">-->
		  {% csrf_token %}
  {% for room_obj in rooms_list %}
    <div class="room-and-time clearfix">
        <div class="col-sm-3">{{room_obj.room_name}}</div>
        <div class="col-sm-9 selectors">
          {% for block in TimingsList %}
          <div class="col-sm-2 checkbox-removed">
            {% for time in block %}
              {% if for_date|Concat:time|IsBooked:room_obj %}
                <span><input type="checkbox" name="BookingTime" id="two2" disabled /><label for="two2"></label></span>
              {% else %}
                <span><input type="checkbox" name="BookingTime" id="one{{room_obj}}{{time}}" data-value='{{time}}' value="{{room_obj.id}}/{{time}}" /><label for="one{{room_obj}}{{time}}"></label></span>
              {% endif %}
            {% endfor %}
          </div>
          {% endfor %}

        </div>
    </div><!--end of room-and-time-->
    {% endfor %}
		
     <input type="submit" class="btn btn-success pull-right" value="Submit" />
</form>





</div><!--end of rooms-and-time-->


<hr>

<div class="row bookings margin-0">
	<h4>Your Bookings</h4>
	{% for obj in bookings_list %}
		<div class="col-sm-12 booking" id="BookingObject-{{obj.id}}">
			<div class="col-sm-4">{{obj.room.get_location_display}}</div>
			<div class="col-sm-4">{{obj.from_time|date}}, {{obj.from_time|time:"H:i"}} - {{obj.to_time|time:"H:i"}}</div>
			<div class="col-sm-4"><button class="CancelBooking" class="btn btn-danger btn-sm pull-right" data-value="{{obj.id}}">Cancel</button></div>
		</div>
	{% endfor %}
</div>

<hr>

<!--<div id="submit-section" class="col-sm-12">
  <p class="pull-left booker">V L Nagaraj - Media Team</p>
 
</div>-->

</div><!--end of panel-->

<script>
	$(document).ready(function(){
		 $('#reset-btn').click(function(){
				$('input[type="checkbox"]').attr('checked', false);
			});
		});

        $("#BookMeetingForm").submit(function(){
                
            var formData = new FormData($(this)[0]);
						alert(formData);
						var for_date = $('#id_for_date').val();
						formData.append('for_date', for_date);
            //form_id = $(this)[0].grievance_id.value;
            //form_element = $(this);
            //ajax_loader_element = $("#SubmitAndCLoseFormAjaxLoader_" + form_id);
            
            swal({   title: "Are you sure you want to book these rooms?",
                text: "You will not be able to edit this after submission!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, Submit it!",
                cancelButtonText: "Cancel",
                closeOnConfirm: true,
                closeOnCancel: true
                },
                function(isConfirm){
                    // If user clicks on ok;
                    if (isConfirm) {
                        //ShowAjaxLoader(ajax_loader_element, form_element.width(), form_element.height());
                        $.ajax({
                            url: '/bookings/',
                            type: 'POST',
                            data: formData,
                            success: function (data) {
                                if (data.errors) {
                                    $("#server_errors").html(data.errors);
                                }
                                if (data.record_added == true) {
                                    alert("success");
                                }
                                //HideAjaxLoader(ajax_loader_element);
                            },
                            error: function(XMLHttpRequest, textStatus, errorThrown) {
                                alert(errorThrown);
                            },
                            cache: false,
                            contentType: false,
                            processData: false
                        });
                    
                    } 
                    
                    
                   });
                    
            return false;
        });
				
				$(".CancelBooking").click(function(){
   
            cancel_id = $(this).attr('data-value');
						alert(cancel_id);
						
            swal({   title: "Are you sure you want to book these rooms?",
                text: "You will not be able to edit this after submission!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, Submit it!",
                cancelButtonText: "Cancel",
                closeOnConfirm: true,
                closeOnCancel: true
                },
                function(isConfirm){
                    // If user clicks on ok;
                    if (isConfirm) {
                        //ShowAjaxLoader(ajax_loader_element, form_element.width(), form_element.height());
                        $.ajax({
                            url: '/bookings/cancel/',
                            type: 'POST',
                            data: {'cancel_id':cancel_id},
                            success: function (data) {
                                
                                if (data.record_updated == true) {
                                    alert("success");
                                }
																if (data.user_mismatch == true) {
                                    alert("User mismatch.You cannot cancel others' bookings");
                                }
                                //HideAjaxLoader(ajax_loader_element);
                            },
                            error: function(XMLHttpRequest, textStatus, errorThrown) {
                                alert(errorThrown);
                            },
                            cache: false,
                            contentType: false,
                            processData: false
                        });
                    
                    } 
                    
                    
                   });
                    
            return false;
        });

</script>
