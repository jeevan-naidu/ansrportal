{% extends 'timesheetEntry.html'  %}

{% block siteTitle %}Timesheet{% endblock %}

{% load permissions %}
{% block pageTitle %}
Approve Timesheet
{% for message in messages %}
    <li class="{{ message.tags }}">
    {% if 'safe' in message.tags %}{{ message|safe }}{% else %}{{ message }}{% endif %}
    </li>
{% endfor %}
{% endblock %}
{% block switch_dates %}
<div class="dropdown week-selector pull-left">
  <button class="btn btn-default dropdown-toggle left-text" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
  <i class="fa fa-calendar" style="margin-right:5px;color:#999"></i>
    {{ weekstartDate|date:"d-M" }} - {{ weekendDate|date:"d-M" }}
    <!-- <span class="caret"></span> -->
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
       {% for date_range in week_collection  %}
           <li>{% with result=status_dict|get_item:date_range %}
               {% for k,v in result.items %}
                    {% if k == 'status'  and v == 'approved' %}
                         <a href="approve?startdate={{ result.wkstart }}&enddate={{ result.wkend }}" data-value="action" class="filled">
                           {{ date_range }}
                         </a>
                    {% else %}
                        {% if k == 'status' and v == 'partial' %}
                                <a href="approve?startdate={{ result.wkstart }}&enddate={{ result.wkend }}" data-value="action" class="incomplete">
                                   {{ date_range}}
                                 </a>
                        {% endif %}
                        {% if  k == 'status' and v == 'not_approved'  %}
                            <a href="approve?startdate={{ result.wkstart }}&enddate={{ result.wkend }}" data-value="action" class="unfilled">
                                    {{ date_range}}
                            </a>
                        {% endif %}
                    {% endif %}
               {% endfor %} {%endwith %}
           </li>
      {% endfor %}

  </ul>
</div>



{% endblock %}
{% block timesheetContent %}

<link href="/static/plugins/dataTables/css/dataTables.bootstrap.css" rel="stylesheet" type="text/css">



<div class="panel pb-15">

    <div class="panel-body">
           <div class="form-inline approve-reject pull-right">
                                       <div class="checkbox checkbox-success">
                                          <input id="approve_all" type="checkbox" name="approve_all" class="approve_all">
                                          <label for="approve_all" class="lh-16">
                                             Approve All
                                          </label>
                                      </div>&nbsp;&nbsp;&nbsp;
                                      <div class="checkbox checkbox-danger">
                                          <input id="reject_all" type="checkbox" name="reject_all" class="reject_all" >
                                          <label for="reject_all" class="lh-16">
                                              Reject All
                                          </label>
                                      </div>
                                  </div>

<form method="post" action=""> {% csrf_token %}
<table class="table table-striped" id="timesheet-approve-table">
  <thead>
    <tr>
        <th>Employee Id</th>
      <th>Name</th>
      <th>Billable (Hrs) $ >0</th>
        <th>Billable (Hrs) $ =0</th>
      <th>Non-Billable (Hrs)</th>
      <th>Leave (Hrs)</th>
      <th class="text-center">Options</th>
      <th> Feedback</th>
    </tr>
  </thead>
  <tbody>
  {% for team_members,values in ts_data_list.iteritems %}
    <tr class="odd gradeX"> <td>{{team_members.employee_assigned_id}} </td>
      <td><a href="#myModal_{{team_members.user.id}}" class="timesheet-approve-user-details employee" data-value="{{team_members.user.id}}">{{team_members.user.first_name}} {{team_members.user.last_name}}</a></td>
      <td>{{values.non_zero_value}}</td>
      <td>{{values.zero_value}} </td>
        <td>{{values.non_billable_total}}</td>
      <td> {{values.leave_hours}} </td>

<div class="modal fade" id="myModal_{{team_members.user.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_{{team_members.user.id}}" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-times"></i></button>
                          <h4 class="modal-title" id="myModalLabel_{{team_members.user.id}}">Feedback</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                              <label class="col-sm-4 control-label">Feedback </label>
                              <div class="col-sm-7 controls">
                                <textarea class="input-border-btm" name="feedback_{{team_members.user.id}}" type="text"></textarea>
                              </div>

                            </div>



                        </div>
                        <div class="modal-footer background-login">
                          <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button>
                          <!--<button type="button" class="btn vd_btn vd_bg-green">Save changes</button>-->
                        </div>
                      </div>
                      <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                  </div>



<td class="timesheet-approve-options text-center">
    <div class="checkbox checkbox-success radio-mod btn-xs">
        <input id="approve_{{team_members.user.id}}"  type="checkbox" name="approve[]" class="approve" value="{{team_members.user.id}}">
        <label for="approve_{{team_members.user.id}}"  class="ansr-orange-mod noselect">
        Approve
        </label>
    </div>

    <div class="checkbox checkbox-danger radio-mod btn-xs">
        <input id="reject_{{team_members.user.id}}" type="checkbox" name="reject[]" class="reject" value="{{team_members.user.id}}">
        <label for="reject_{{team_members.user.id}}"  class="noselect">
        Reject
        </label>
    </div>

</td>

    <td class="menu-action">
      <a data-toggle="modal" data-target="#myModal_{{team_members.user.id}}" class="btn menu-icon vd_bd-yellow vd_yellow">
        <i class="fa fa-envelope"></i>
      </a>
    </td>

        <!-- Modal Area -->



{%endfor %}
  </tbody>
</table>
{% if ts_data_list %}
<input type="submit" name="submit">
    <input type="hidden" name="weekstartDate" value="{{weekstartDate|date:"dmY"}}">
    <input type="hidden" name="weekendDate" value="{{weekendDate|date:"dmY"}}">
{% endif %}
</form></div>
</div>



<div class="panel pb-15">
    <div class="panel-body">

<table class="table table-hover">
                      <thead>
                        <tr>
                          <th>Project</th>
                          <th>Chapter</th>
                          <th>Mon</th>
                          <th>Tue</th>
                          <th>Wed</th>
                          <th>Thu</th>
                          <th>Fri</th>
                        </tr>
                      </thead>
                      <tbody>


                        <tr>
                          <td>The name of the project</td>
                          <td>The name of the chapter</td>
                          <td>1</td>
                          <td>2</td>
                          <td>1</td>
                          <td>2</td>
                          <td>1</td>
                        </tr>

                        <tr>
                          <td>The name of the project</td>
                          <td>The name of the chapter</td>
                          <td>1</td>
                          <td>2</td>
                          <td>1</td>
                          <td>2</td>
                          <td>1</td>
                        </tr>

                        <tr>
                          <td>The name of the project</td>
                          <td>The name of the chapter</td>
                          <td>1</td>
                          <td>2</td>
                          <td>1</td>
                          <td>2</td>
                          <td>1</td>
                        </tr>


                      </tbody>
                    </table>

    </div>
</div>



















<script type="text/javascript" src="/static/plugins/dataTables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/static/js/dataTables.bootstrap.js"></script>



<script type="text/javascript">
        $(document).ready(function() {
                "use strict";

            $('#timesheet-approve-table').dataTable();

            /* Toggle checkbox */

            $('.timesheet-approve-options label').click(function(){
              if($(this).parent().find('input[type="checkbox"]').prop("checked") == false){
                $(this).parent().parent().find('input[type="checkbox"]').attr('checked', false);
              }
            })


             $('.employee').on('click', function()  { return false;
                  $.ajax({
                    url: '/myansrsource/timesheet/get_time_sheet',
                    type: 'GET',
                    dataType :'json',
                    data: {"user_id":this.getAttribute('data-value') },
                    success: function (data) {
                    console.log(data);
                        populateForm(data);
                        orderTabs(data);
                        assignMandatory(data);

                        // globalObj to capture the order of tabs

                        globalObj = data;
                    },

                  });
            });
          jQuery('.approve_all , .reject_all').click(function(e){
            if(this.className == 'approve_all') {
                $('.reject_all,.reject ').prop('checked', false);
            }
            else if (this.className == 'reject_all') {
                $('.approve_all,.approve ').prop('checked', false);
            }
            var class_name = this.className.split('_');
            if($('#'+this.id).prop('checked')) {
                $('.'+class_name[0]).prop('checked', true);
            }
            else {
                $('.'+class_name[0]).prop('checked', false);
            }

        });
        jQuery('.approve , .reject ').click(function(e){
            var class_name = this.value;
            if(this.className == 'approve') {
                $('#reject_'+class_name).prop('checked', false);
                $('#cancel_'+class_name).prop('checked', false);
                $('.reject_all').prop('checked', false);
            }
            else if (this.className == 'reject') {
                $('#approve_'+class_name).prop('checked', false);
                $('#cancel_'+class_name).prop('checked', false);
                $('.approve_all').prop('checked', false);
            }
            else if (this.className == 'cancel') {
                $('#approve_'+class_name).prop('checked', false);
                $('#reject_'+class_name).prop('checked', false);
                $('.approve_all').prop('checked', false);
                $('.reject_all').prop('checked', false);
            }


        });

        } );
</script>




{% endblock %}









