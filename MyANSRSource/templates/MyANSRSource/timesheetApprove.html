{% extends 'timesheetEntry.html'  %}

{% block siteTitle %}Timesheet{% endblock %}

{% load permissions %}
{% block pageTitle %}
Approve Timesheet
{% for message in messages %}
    <li class="{{ message.tags }}">
    {% if 'safe' in message.tags %}{{ message|safe }}{% else %}{{ message }}{% endif %}
    </li>
{% endfor %}
{% endblock %}
{% block switch_dates %}
<div class="dropdown week-selector pull-left">
  <button class="btn btn-default dropdown-toggle left-text" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
  <i class="fa fa-calendar" style="margin-right:5px;color:#999"></i>
    {{ weekstartDate|date:"d-M" }} - {{ weekendDate|date:"d-M" }}
    <!-- <span class="caret"></span> -->
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
       {% for date_range in week_collection  %}
           <li>{% with result=status_dict|get_item:date_range %}
               {% for k,v in result.items %}
                    {% if k == 'status'  and v == 'approved' %}
                         <a href="approve?startdate={{ result.wkstart }}&enddate={{ result.wkend }}" data-value="action" class="filled">
                           {{ date_range }}
                         </a>
                    {% else %}
                        {% if k == 'status' and v == 'partial' %}
                                <a href="approve?startdate={{ result.wkstart }}&enddate={{ result.wkend }}" data-value="action" class="incomplete">
                                   {{ date_range}}
                                 </a>
                        {% endif %}
                        {% if  k == 'status' and v == 'not_approved'  %}
                            <a href="approve?startdate={{ result.wkstart }}&enddate={{ result.wkend }}" data-value="action" class="unfilled">
                                    {{ date_range}}
                            </a>
                        {% endif %}
                    {% endif %}
               {% endfor %} {%endwith %}
           </li>
      {% endfor %}

  </ul>
</div>



{% endblock %}
{% block timesheetContent %}

<link href="/static/plugins/dataTables/css/dataTables.bootstrap.css" rel="stylesheet" type="text/css">



<div class="panel pb-15">

    <div class="panel-body"><form method="post" action=""> {% csrf_token %}
           <div class="form-inline approve-reject pull-right">
                <div class="checkbox checkbox-success radio-mod btn-xs">
                  <input type='checkbox' id="reminder_mail" name="reminder_mail" value="send"  data-toggle='tooltip' data-placement='right' data-original-title="Send mail to those didn't submit their time-sheet" class='checkbox'/>
                  <label for="reminder_mail"  class="ansr-orange-mod noselect disable-select">Send Reminder Mail</label>
                </div>
            </div>


<table class="table table-striped" id="timesheet-approve-table">
  <thead>
    <tr>
      <th>Employee Id</th>
      <th>Name</th>
      <th>Billable </th>
      <th>Billable (0$)</th>
      <th>Non-Billable </th>
      <th>Leave</th>
      <th class="text-center">Options</th>
      <th> Feedback</th>
    </tr>
  </thead>
  <tbody>

  {% for team_members,values in ts_data_list_approved_false.iteritems %}
    <tr class="odd gradeX"> 
      <td>{{team_members.employee_assigned_id}} </td>
      <td>
      <a class="timesheet-approve-user-details employee" data-toggle="modal" data-target="#timesheet-approve-report" data-value="{{team_members.user.id}}" style="cursor: pointer;">{{team_members.user.first_name}} {{team_members.user.last_name}}</a>

<!-- Modal Area II -->





                  <div class="modal fade" id="timesheet-approve-report_{{team_members.user.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_{{team_members.user.id}}" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-times"></i></button>
                          <h4 class="modal-title" id="myModalLabel_{{team_members.user.id}}">Feedback</h4>
                        </div>
                        <div class="modal-body">



                    <table class="table table-hover project-table">
                      <thead>
                        <tr>
                          <th>Project</th>
                          <th>Task</th>
                          <th>Mon</th>
                          <th>Tue</th>
                          <th>Wed</th>
                          <th>Thu</th>
                          <th>Fri</th>
                          <th>Thu</th>
                          <th>Fri</th>
                        </tr>
                      </thead>
                      <tbody>


                        <tr>
                          <td class="project_name">The name of the project</td>
                          <td class="task">The name of the Task</td>
                          <td class="mondayH">0</td>
                          <td class="tuesdayH">0</td>
                          <td class="wednesdayH">0</td>
                          <td class="thursdayH">0</td>
                          <td class="fridayH">0</td>
                          <td class="saturdayH">0</td>
                          <td class="sundayH">0</td>
                        </tr>


                        <tr class="total-row">
                          <td></td>
                          <td>Total</td>
                          <td>0</td>
                          <td>0</td>
                          <td>0</td>
                          <td>0</td>
                          <td>0</td>
                          <td>0</td>
                          <td>0</td>
                        </tr>

                      </tbody>
                    </table>

<hr>


                    <table class="table table-hover activity-table">
                      <thead>
                        <tr>
                          <th>Activity</th>
                          <th>Mon</th>
                          <th>Tue</th>
                          <th>Wed</th>
                          <th>Thu</th>
                          <th>Fri</th>
                          <th>Thu</th>
                          <th>Fri</th>
                        </tr>
                      </thead>
                      <tbody>


                        <tr>
                          <td class="activity_name">The name of the activity</td>
                          <td class="activity_monday">0</td>
                          <td class="activity_tuesday">0</td>
                          <td class="activity_wednesday">0</td>
                          <td class="activity_thursday">0</td>
                          <td class="activity_friday">0</td>
                          <td class="activity_saturday">0</td>
                          <td class="activity_sunday">0</td>
                        </tr>


                        <tr class="total-row">
                          <td>Total</td>
                          <td class="monday_total">0</td>
                          <td class="tuesday_total">0</td>
                          <td class="wednesday_total">0</td>
                          <td class="thursday_total">0</td>
                          <td class="friday_total">0</td>
                          <td class="saturday_total">0</td>
                          <td class="sunday_total">0</td>
                        </tr>

                      </tbody>
                    </table>

                        </div><!-- ./modal-body -->
                        <div class="modal-footer background-login">
                          <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button>
                          <!--<button type="button" class="btn vd_btn vd_bg-green">Save changes</button>-->
                        </div>
                      </div>
                      <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                  </div>

<!-- ./Modal Area II -->


      </td>
      <td>{{values.non_zero_value}}</td>
      <td>{{values.zero_value}}  </td>
      <td>{{values.non_billable_total}}</td>
      <td> {{values.leave_hours}} </td>

                  <div class="modal fade" id="myModal_{{team_members.user.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_{{team_members.user.id}}" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-times"></i></button>
                          <h4 class="modal-title" id="myModalLabel_{{team_members.user.id}}">Feedback</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                              <label class="col-sm-4 control-label">Feedback </label>
                              <div class="col-sm-7 controls">
                                <textarea class="input-border-btm" name="feedback_{{team_members.user.id}}" type="text"></textarea>
                              </div>

                            </div>



                        </div>
                        <div class="modal-footer background-login">
                          <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button>
                          <!--<button type="button" class="btn vd_btn vd_bg-green">Save changes</button>-->
                        </div>
                      </div>
                      <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                  </div>



<td class="timesheet-approve-options text-center radio-padding-mod">

  <div class="checkbox checkbox-success radio-mod btn-xs">
        <input id="approve_{{team_members.user.id}}"  type="checkbox" name="approve[]" class="approve" value="{{team_members.user.id}}">
        <label for="approve_{{team_members.user.id}}"  class="ansr-orange-mod noselect disable-select">
        Approve
        </label>
    </div>

    <div class="checkbox checkbox-danger radio-mod btn-xs">
        <input id="reject_{{team_members.user.id}}" type="checkbox" name="reject[]" class="reject" value="{{team_members.user.id}}">
        <label for="reject_{{team_members.user.id}}"  class="noselect disable-select">
        Reject
        </label>
    </div>

</td>

    <td class="menu-action">
      <a data-toggle="modal" data-target="#myModal_{{team_members.user.id}}" class="btn menu-icon vd_bd-yellow vd_yellow">
        <i class="fa fa-envelope"></i>
      </a>
    </td>

        <!-- Modal Area -->


</tr>
{%endfor %}

   {% for team_members,values in ts_data_list_approved_true.iteritems %}
    <tr class="odd gradeX"> 
      <td>{{team_members.employee_assigned_id}} </td>
      <td>
      <a class="timesheet-approve-user-details employee" data-toggle="modal" data-target="#timesheet-approve-report" data-value="{{team_members.user.id}}" style="cursor: pointer;">{{team_members.user.first_name}} {{team_members.user.last_name}}</a>

<!-- Modal Area II -->





                  <div class="modal fade" id="timesheet-approve-report_{{team_members.user.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_{{team_members.user.id}}" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-times"></i></button>
                          <h4 class="modal-title" id="myModalLabel_{{team_members.user.id}}">Feedback</h4>
                        </div>
                        <div class="modal-body">
                    <table class="table table-hover project-table">
                      <thead>
                        <tr>
                          <th>Project</th>
                          <th>Task</th>
                          <th>Mon</th>
                          <th>Tue</th>
                          <th>Wed</th>
                          <th>Thu</th>
                          <th>Fri</th>
                          <th>Thu</th>
                          <th>Fri</th>
                        </tr>
                      </thead>
                      <tbody>


                        <tr>
                          <td class="project_name">The name of the project</td>
                          <td class="task">The name of the Task</td>
                          <td class="mondayH">0</td>
                          <td class="tuesdayH">0</td>
                          <td class="wednesdayH">0</td>
                          <td class="thursdayH">0</td>
                          <td class="fridayH">0</td>
                          <td class="saturdayH">0</td>
                          <td class="sundayH">0</td>
                        </tr>


                        <tr class="total-row">
                          <td></td>
                          <td>Total</td>
                          <td>0</td>
                          <td>0</td>
                          <td>0</td>
                          <td>0</td>
                          <td>0</td>
                          <td>0</td>
                          <td>0</td>
                        </tr>

                      </tbody>
                    </table>

<hr>


                    <table class="table table-hover activity-table">
                      <thead>
                        <tr>
                          <th>Activity</th>
                          <th>Mon</th>
                          <th>Tue</th>
                          <th>Wed</th>
                          <th>Thu</th>
                          <th>Fri</th>
                          <th>Thu</th>
                          <th>Fri</th>
                        </tr>
                      </thead>
                      <tbody>


                        <tr>
                          <td class="activity_name">The name of the activity</td>
                          <td class="activity_monday">0</td>
                          <td class="activity_tuesday">0</td>
                          <td class="activity_wednesday">0</td>
                          <td class="activity_thursday">0</td>
                          <td class="activity_friday">0</td>
                          <td class="activity_saturday">0</td>
                          <td class="activity_sunday">0</td>
                        </tr>


                        <tr class="total-row">
                          <td>Total</td>
                          <td class="monday_total">0</td>
                          <td class="tuesday_total">0</td>
                          <td class="wednesday_total">0</td>
                          <td class="thursday_total">0</td>
                          <td class="friday_total">0</td>
                          <td class="saturday_total">0</td>
                          <td class="sunday_total">0</td>
                        </tr>

                      </tbody>
                    </table>
                        </div>
                        <div class="modal-footer background-login">
                          <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button>
                          <!--<button type="button" class="btn vd_btn vd_bg-green">Save changes</button>-->
                        </div>
                      </div>
                      <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                  </div>

<!-- ./Modal Area II -->


      </td>
      <td>{{values.non_zero_value}}</td>
      <td>{{values.zero_value}} </td>
      <td>{{values.non_billable_total}}</td>
      <td> {{values.leave_hours}} </td>

                  <div class="modal fade" id="myModal_{{team_members.user.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_{{team_members.user.id}}" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-times"></i></button>
                          <h4 class="modal-title" id="myModalLabel_{{team_members.user.id}}">Feedback</h4>
                        </div>
                        <div class="modal-body">
                          <div class="form-group">
                            <label class="col-sm-4 control-label">Feedback </label>
                            <div class="col-sm-7 controls">
                              <textarea class="input-border-btm" name="feedback_{{team_members.user.id}}" type="text"></textarea>
                            </div>
                          </div>
                        </div>
                        <div class="modal-footer background-login">
                          <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button>
                          <!--<button type="button" class="btn vd_btn vd_bg-green">Save changes</button>-->
                        </div>
                      </div>
                      <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                  </div>



<td class="timesheet-approve-options text-center">
   <div><span> Already Approved</span></div>

</td>

    <td class="menu-action">
      <a data-toggle="modal" data-target="#myModal_{{team_members.user.id}}" class="btn menu-icon vd_bd-yellow vd_yellow">
        <i class="fa fa-envelope"></i>
      </a>
    </td>

        <!-- Modal Area -->


</tr>
{%endfor %}



  </tbody>
</table>
{% if ts_data_list %}
<input type="submit" name="submit" class="btn btn-primary btn-sm pull-right" value="Submit">
    <input type="hidden" name="weekstartDate" id="weekstartDate" value="{{weekstartDate|date:"dmY"}}">
    <input type="hidden" name="weekendDate" id="weekendDate" value="{{weekendDate|date:"dmY"}}">
{% endif %}
</form>
</div>
</div>








<!-- Modal Area III -->


                  <div class="modal fade" id="timesheet-approve-report" tabindex="-1" role="dialog" aria-labelledby="timesheet-approve-report" aria-hidden="true" style="display: none;">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                        <div class="modal-header vd_bg-blue vd_white">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-times"></i></button>
                          <h4 class="modal-title" id="timesheet-approve-report-body">Timesheet Overview : <span class="timesheet-member-name"></span></h4>
                        </div>
                        <div class="modal-body">
                    <table class="table table-hover project-table">
                      <thead>
                        <tr>
                          <th>Project</th>
                          <th>Task</th>
                          <th>Mon</th>
                          <th>Tue</th>
                          <th>Wed</th>
                          <th>Thu</th>
                          <th>Fri</th>
                          <th>Thu</th>
                          <th>Fri</th>
                        </tr>
                      </thead>
                      <tbody>


                        <tr class="project-time-row">
                          <td class="project_name">The name of the project</td>
                          <td class="task">The name of the Task</td>
                          <td class="mondayH">0</td>
                          <td class="tuesdayH">0</td>
                          <td class="wednesdayH">0</td>
                          <td class="thursdayH">0</td>
                          <td class="fridayH">0</td>
                          <td class="saturdayH">0</td>
                          <td class="sundayH">0</td>
                        </tr>


                      </tbody>
                    </table>

<hr>


                    <table class="table table-hover activity-table">
                      <thead>
                        <tr>
                          <th>Activity</th>
                          <th>Mon</th>
                          <th>Tue</th>
                          <th>Wed</th>
                          <th>Thu</th>
                          <th>Fri</th>
                          <th>Thu</th>
                          <th>Fri</th>
                        </tr>
                      </thead>


                      <tbody>
                        <tr class="activity-time-row">
                          <td class="activity_name">The name of the activity</td>
                          <td class="activity_monday">0</td>
                          <td class="activity_tuesday">0</td>
                          <td class="activity_wednesday">0</td>
                          <td class="activity_thursday">0</td>
                          <td class="activity_friday">0</td>
                          <td class="activity_saturday">0</td>
                          <td class="activity_sunday">0</td>
                        </tr>


                        <tr class="total-row">
                          <td>Total</td>
                          <td class="monday_total">0</td>
                          <td class="tuesday_total">0</td>
                          <td class="wednesday_total">0</td>
                          <td class="thursday_total">0</td>
                          <td class="friday_total">0</td>
                          <td class="saturday_total">0</td>
                          <td class="sunday_total">0</td>
                        </tr>

                      </tbody>
                    </table>
                        </div>
                        <div class="modal-footer background-login">
                          <button type="button" class="btn vd_btn vd_bg-grey" data-dismiss="modal">Close</button>
                          <!--<button type="button" class="btn vd_btn vd_bg-green">Save changes</button>-->
                        </div>
                      </div>
                      <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                  </div>

<!-- ./Modal Area III -->









<script type="text/javascript" src="/static/plugins/dataTables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/static/js/dataTables.bootstrap.js"></script>



<script type="text/javascript">

var project_time_row = $('.project-time-row').html();
var activity_time_row = $('.activity-time-row').html();
var total_row = $('.total-row').html();



// Functions

var time_iterate = function(e){

  var time_obj = e;

  console.log(time_obj);


  // tsdata iteration

  for (var time_key in time_obj['tsData']){
    if (time_obj['tsData'].hasOwnProperty(time_key)){

      // Console log section

      console.log(time_key);
      console.log(time_obj['tsData'][time_key]);
      console.log(time_obj.tsData[0]['id']);

      // Get length

      var obj_length = time_obj.tsData.length;
      console.log(obj_length);

      // Append employee name to modal header

      $('.timesheet-member-name').html(time_obj.tsData[0]['id']);
    }
  } // ./ ts data iteration




  // total_list iteration

  for (var time_key in time_obj['total_list']){
    if (time_obj['total_list'].hasOwnProperty(time_key)){  
      console.log(time_obj.total_list[0]['friday_total']);
      $('#timesheet-approve-report .monday_total').html(time_obj.total_list[0]['monday_total']);
      $('#timesheet-approve-report .tuesday_total').html(time_obj.total_list[0]['tuesday_total']);
      $('#timesheet-approve-report .wednesday_total').html(time_obj.total_list[0]['wednesday_total']);
      $('#timesheet-approve-report .thursday_total').html(time_obj.total_list[0]['thursday_total']);
      $('#timesheet-approve-report .friday_total').html(time_obj.total_list[0]['friday_total']);
      $('#timesheet-approve-report .saturday_total').html(time_obj.total_list[0]['saturday_total']);
      $('#timesheet-approve-report .sunday_total').html(time_obj.total_list[0]['sunday_total']);
    }
  }


}



$(document).ready(function() {
                "use strict";

            // $('#timesheet-approve-table').dataTable();
        $("[data-toggle='tooltip']").tooltip();

            /* Toggle checkbox */

            $('.timesheet-approve-options label').click(function(){
              if($(this).parent().find('input[type="checkbox"]').prop("checked") == false){
                $(this).parent().parent().find('input[type="checkbox"]').attr('checked', false);
              }
            })


             $('.employee').on('click', function()  { console.log("click");

                  $.ajax({
                    url: '/myansrsource/timesheet/time_sheet_employee',
                    type: 'GET',
                    dataType :'json',
                    data: {"user_id":this.getAttribute('data-value') ,"start_date":$('#weekstartDate').val(),"end_date":$('#weekendDate').val() },
                    success: function (data) {
                    // console.log(JSON.stringify(data));
                    time_iterate(data);
                    },

                  });
            });

        jQuery('.approve , .reject ').click(function(e){
            var class_name = this.value;
            if(this.className == 'approve') {
                $('#reject_'+class_name).prop('checked', false);
                $('#cancel_'+class_name).prop('checked', false);
                $('.reject_all').prop('checked', false);
            }
            else if (this.className == 'reject') {
                $('#approve_'+class_name).prop('checked', false);

            }
            else if (this.className == 'cancel') {
                $('#approve_'+class_name).prop('checked', false);
                $('#reject_'+class_name).prop('checked', false);

            }


        });

} ); // ./doc-ready
</script>




{% endblock %}









